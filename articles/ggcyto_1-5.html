<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualization (1.5) • CytoverseBioc2023</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visualization (1.5)">
<meta property="og:description" content="CytoverseBioc2023">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CytoverseBioc2023</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Bioc2023_Cytoverse.html">Reproducible and programmatic analysis of flow cytometry experiments with the cytoverse</a>
    </li>
    <li>
      <a href="../articles/Gating_1.html">Gating Cells in cytoverse</a>
    </li>
    <li>
      <a href="../articles/HOWTO_BUILD_WORKSHOP.html">How To Build A Workshop Package</a>
    </li>
    <li>
      <a href="../articles/Import_fcs.html">Importing and Basics of working with FCS files</a>
    </li>
    <li>
      <a href="../articles/Reporting_1.html">Reporting: Bringing Everything Together</a>
    </li>
    <li>
      <a href="../articles/Spillover_v2.html">Spillover, compensation, Transformations, and Visualization</a>
    </li>
    <li>
      <a href="../articles/ggcyto_1-5.html">Visualization (1.5)</a>
    </li>
    <li>
      <a href="../articles/workshop_example.html">An Example Workshop</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OzetteTech/cytoverse-bioc-2023" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Visualization (1.5)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OzetteTech/cytoverse-bioc-2023/blob/HEAD/vignettes/ggcyto_1-5.Rmd" class="external-link"><code>vignettes/ggcyto_1-5.Rmd</code></a></small>
      <div class="hidden name"><code>ggcyto_1-5.Rmd</code></div>

    </div>

    
    
<p>We have spent a bit of time going over import, manupulation,
compensation, and transformation of flow cytometry data. Importantly, we
have used visualizations to highlight the importance of various steps.
Here, we dedicate some time to visualization of flow cytometry data
using <code>ggcyto</code> library from the <code>cytoverse</code></p>
<p>For those who have experience working with <code>ggplot</code>, the
approach is going to be similar. As such, <code>ggcyto</code> provides a
easy to use yet powerful approach to visualize flow cytometry data.</p>
<p>It is also important to note that <code>ggcyto</code> works with each
of <code>flowFrame</code>, <code>flowSet</code>, <code>cytoframe</code>,
<code>cytoset</code>, <code>GatingSet</code>, and
<code>GatingHierarchy</code> and allows the user to utilize various
attributes of each of the object. For instance,
<strong>metadata</strong> within <code>pData</code> slot in
<code>flowSet</code>/<code>cytoset</code> and <code>GatingSet</code> to
prepare insightful visualizations, rapidly.</p>
<p>[THE GATINGSET BEING USED AS AN EXAMPLE SEEMS TO HAVE LOST
INFORMATION REGARDING TRANSFORMATION. WILL PLOTclass]</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowCore</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RGLab/ggcyto/issues" class="external-link">ggcyto</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: ggplot2</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: ncdfFlow</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: BH</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: flowWorkspace</span></span></code></pre>
<pre><code><span><span class="co">## As part of improvements to flowWorkspace, some behavior of</span></span>
<span><span class="co">## GatingSet objects has changed. For details, please read the section</span></span>
<span><span class="co">## titled "The cytoframe and cytoset classes" in the package vignette:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   vignette("flowWorkspace-Introduction", "flowWorkspace")</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set theme</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ozettetech.github.io/cytoverse-bioc-2023/">CytoverseBioc2023</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Biobase</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: BiocGenerics</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'BiocGenerics'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:flowCore':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     normalize</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     IQR, mad, sd, var, xtabs</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     anyDuplicated, aperm, append, as.data.frame, basename, cbind,</span></span>
<span><span class="co">##     colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,</span></span>
<span><span class="co">##     get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,</span></span>
<span><span class="co">##     match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,</span></span>
<span><span class="co">##     Position, rank, rbind, Reduce, rownames, sapply, setdiff, sort,</span></span>
<span><span class="co">##     table, tapply, union, unique, unsplit, which.max, which.min</span></span></code></pre>
<pre><code><span><span class="co">## Welcome to Bioconductor</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Vignettes contain introductory material; view with</span></span>
<span><span class="co">##     'browseVignettes()'. To cite Bioconductor, see</span></span>
<span><span class="co">##     'citation("Biobase")', and for packages 'citation("pkgname")'.</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: openCyto</span></span></code></pre>
<pre><code><span><span class="co">## Warning: replacing previous import 'flowViz::contour' by 'graphics::contour'</span></span>
<span><span class="co">## when loading 'flowStats'</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cache_workshop_data.html">cache_workshop_data</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: did not converge in 100 iterations</span></span></code></pre>
<div class="section level3">
<h3 id="hit-the-ground-running-using-autoplot">Hit the ground running using <code>autoplot</code><a class="anchor" aria-label="anchor" href="#hit-the-ground-running-using-autoplot"></a>
</h3>
<p>The <code>autoplot</code> method is a convenient for rapid generation
of plots with minimal effort.</p>
<ol style="list-style-type: decimal">
<li>Bivariate plot</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># flowFrame: bivariate plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">ff</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"CD4"</span>, <span class="co"># markername in human readable format</span></span>
<span>         y <span class="op">=</span> <span class="st">"R730-A"</span>, <span class="co"># markername as colname of flowFrame </span></span>
<span>         bins <span class="op">=</span> <span class="fl">256</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/autoplot_ff-1.png" width="700"></p>
<ol start="2" style="list-style-type: decimal">
<li>Density plot</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># flowFrame: density plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">ff</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"CD4"</span><span class="op">)</span><span class="op">+</span> <span class="co"># y not results in a density plot</span></span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="co"># utilize ggplot geom</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/autoplot_ff_test-1.png" width="700"></p>
<ol start="3" style="list-style-type: decimal">
<li>Bivariate plot of the entire <code>GatingHeirarchy</code>
</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GatingSet: full GatingHierachy</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">gs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="co"># single GatingHierachy will plot the entire gating path</span></span>
<span>        bins <span class="op">=</span> <span class="fl">256</span><span class="op">)</span><span class="op">+</span> <span class="co"># bins control resolution</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto_par_set.html" class="external-link">ggcyto_par_set</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span><span class="op">+</span> <span class="co"># axis limits based on data </span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_stats.html" class="external-link">geom_stats</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gate_name"</span>,<span class="st">"percent"</span><span class="op">)</span><span class="op">)</span> <span class="co"># add name of gate and statistic</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/gs_autoplot-1.png" width="960"></p>
<ol start="4" style="list-style-type: decimal">
<li>Specific node within a <code>GatingSet</code>
</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GatingSet: single gate</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">gs</span>,</span>
<span>         gate <span class="op">=</span> <span class="st">"CD3+ T cells"</span>, <span class="co"># plot a specific gate for all samples </span></span>
<span>         bins <span class="op">=</span> <span class="fl">256</span><span class="op">)</span><span class="op">+</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto_par_set.html" class="external-link">ggcyto_par_set</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span><span class="op">+</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/axis_x_inverse_trans.html" class="external-link">axis_x_inverse_trans</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co"># inverse transform the axes</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/axis_x_inverse_trans.html" class="external-link">axis_y_inverse_trans</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/gs_autoplot_gate-1.png" width="700"></p>
<p><em>Note</em>: When working with <code>GatingSet</code> or
<code>GatingHierarchy</code>, the <code>autoplot</code> method does not
take <strong>x</strong> and <strong>y</strong> parameters. Rather either
a **gate* can be specified or if left unspecified, the entire
<code>GatingHierachy</code> is plotted.</p>
</div>
<div class="section level3">
<h3 id="granular-control-using-ggcyto">Granular control using <code>ggcyto</code><a class="anchor" aria-label="anchor" href="#granular-control-using-ggcyto"></a>
</h3>
<p>The <code>ggcyto</code> method takes us 1 step deeper into granular
control when visualizing cytometry data. Using this method, users can
now start to make visualizations not afforded by
<code>autoplot</code>.</p>
<ol style="list-style-type: decimal">
<li>Bivariate plot for data within a specific node using markers other
than those defined for a node</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto.html" class="external-link">ggcyto</a></span><span class="op">(</span><span class="va">gs</span>,</span>
<span>       subset <span class="op">=</span> <span class="st">"singlet"</span>, <span class="co"># extract data at specific node</span></span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"CD8a"</span>, y <span class="op">=</span> <span class="st">"CD4"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># any marker combination </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html" class="external-link">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">256</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/gs_ggcyto-1.png" width="700"></p>
<p>The marker combination “CD8a vs CD4” is used to at the node
<code>gs_get_pop_paths(gs)[8]</code> to define CD4+ vs CD8+ T cells.
Unlike with <code>autoplot</code>, <code>ggcyto</code> method allows us
to look at the data from the point of <code>subset</code>. In the above
example, <code>subset = "singlet</code>.</p>
<ol start="2" style="list-style-type: decimal">
<li>Adding a gate and stats layer that doesn’t exist in the
<code>subset</code> node</li>
</ol>
<p>During reporting, it is possible that users would want to see</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get a gate</span></span>
<span><span class="va">cd4_gate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gs_pop_get_gate.html" class="external-link">gs_pop_get_gate</a></span><span class="op">(</span><span class="va">gs</span>,<span class="st">"CD4+CD8a-"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto.html" class="external-link">ggcyto</a></span><span class="op">(</span><span class="va">gs</span>,</span>
<span>       subset <span class="op">=</span> <span class="st">"singlet"</span>, <span class="co"># extract data at specific node</span></span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"CD8a"</span>, y <span class="op">=</span> <span class="st">"CD4"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># any marker combination </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html" class="external-link">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">256</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html" class="external-link">geom_gate</a></span><span class="op">(</span><span class="va">cd4_gate</span><span class="op">)</span><span class="op">+</span> <span class="co"># plot gate</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_stats.html" class="external-link">geom_stats</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"percent"</span><span class="op">)</span><span class="op">+</span> <span class="co"># on the fly calculation of the "gate" event</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/axis_x_inverse_trans.html" class="external-link">axis_x_inverse_trans</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/axis_x_inverse_trans.html" class="external-link">axis_y_inverse_trans</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/ggcyto_gs_add_gate-1.png" width="700"></p>
<p><em>Note</em>: This population has not been defined in the
<code>GatingSet</code>! Yet, we are able to connect multiple components
to generate an informative report quickly. We now know that CD4+ cells
(not sure at this point if they are CD3+ T cells) are ~47% of total
<code>singlet</code> population that we had defined.</p>
<p>In a similar manner, we can use a newly defined gate to interrogate
the <code>GatingSet</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_gate</span> <span class="op">&lt;-</span> <span class="fu">flowCore</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/rectangleGate-class.html" class="external-link">rectangleGate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"V570-A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>,<span class="fl">210</span><span class="op">)</span>,</span>
<span>       <span class="st">"V510-A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">140</span>,<span class="fl">210</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  filterId <span class="op">=</span> <span class="st">"CD3+CD8a+ Cells"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto.html" class="external-link">ggcyto</a></span><span class="op">(</span><span class="va">gs</span>,</span>
<span>       subset <span class="op">=</span> <span class="st">"singlet"</span>, <span class="co"># extract data at specific node</span></span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"CD3"</span>, y <span class="op">=</span> <span class="st">"CD8a"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># any marker combination </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html" class="external-link">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">256</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">mock_treatment</span><span class="op">~</span><span class="va">name</span><span class="op">)</span><span class="op">+</span> <span class="co"># facet according to treatment</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_gate.html" class="external-link">geom_gate</a></span><span class="op">(</span><span class="va">new_gate</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto_par_set.html" class="external-link">ggcyto_par_set</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_stats.html" class="external-link">geom_stats</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"percent"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/axis_x_inverse_trans.html" class="external-link">axis_x_inverse_trans</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/axis_x_inverse_trans.html" class="external-link">axis_y_inverse_trans</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/ggcyto_gs_add_gate_new-1.png" width="700"></p>
<p>Above we created a gate, did not apply it to a <code>GatingSet</code>
directly, but are now leveraging the <code>ggcyto</code> library to
rapidly generate insight regarding CD8a+ CD3+ T cells from the
<code>singlet</code> node. Moreover, we have leveraged the metadata from
<code>pData</code> to generate additional insight regarding the
data.</p>
<div class="section level4">
<h4 id="expression-using-histograms-and-densities">Expression using histograms and densities<a class="anchor" aria-label="anchor" href="#expression-using-histograms-and-densities"></a>
</h4>
<p>A common way to report or view specific population data is to ask
whether there is a change in expression levels (fluoresence intensity)
across samples or groups.</p>
<p>Let’s take a look at PD1 expression in CD8+ T Cells</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cd8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/as.ggplot.html" class="external-link">as.ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto.html" class="external-link">ggcyto</a></span><span class="op">(</span><span class="va">gs</span>,</span>
<span>       subset <span class="op">=</span> <span class="st">"CD4-CD8a+"</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"PD1"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">125</span>, fill <span class="op">=</span> <span class="st">"yellow"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">name</span><span class="op">~</span><span class="va">mock_treatment</span>,ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggcyto</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/labs_cyto.html" class="external-link">labs_cyto</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="st">"marker"</span><span class="op">)</span><span class="op">)</span> <span class="co"># labeling only marker</span></span>
<span><span class="va">cd8</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/ggcyto_histogram-1.png" width="700"></p>
<p>What if you would like to compare 2 different populations side by
side?</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cd4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/as.ggplot.html" class="external-link">as.ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto.html" class="external-link">ggcyto</a></span><span class="op">(</span><span class="va">gs</span>,</span>
<span>              subset <span class="op">=</span> <span class="st">"CD4+CD8a-"</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"PD1"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">125</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">name</span><span class="op">~</span><span class="va">mock_treatment</span>,ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggcyto</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/labs_cyto.html" class="external-link">labs_cyto</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="st">"marker"</span><span class="op">)</span><span class="op">)</span> <span class="co"># labeling only marker</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">cd4</span>,<span class="va">cd8</span>, ncol <span class="op">=</span><span class="fl">2</span> <span class="op">)</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/ggcyto_gs_arrange-1.png" width="700"></p>
<p>Or, if you would like to compare population on top of each other?</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overlay</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto.html" class="external-link">ggcyto</a></span><span class="op">(</span><span class="va">gs</span>,</span>
<span>                  subset <span class="op">=</span> <span class="st">"CD4+CD8a-"</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"PD1"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_overlay.html" class="external-link">geom_overlay</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gh_pop_get_data.html" class="external-link">gs_pop_get_data</a></span><span class="op">(</span><span class="va">gs</span>,<span class="st">"MAIT Cells"</span><span class="op">)</span>, <span class="co"># extracting information regarding a different population</span></span>
<span>    fill <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/axis_x_inverse_trans.html" class="external-link">axis_x_inverse_trans</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comparing expression of PD1 in 2 distinct T cells: CD8a+ (red) and CD161+ Va7_2+ MAIT Cells (black)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">mock_treatment</span><span class="op">~</span><span class="va">name</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">overlay</span></span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/ggcyto_geom_overlay-1.png" width="960"></p>
<p>Seems like MAIT Cells tend to have higher PD1 expression than CD8+ T
Cells! This may be an interesting observation that is worth following up
on.</p>
</div>
</div>
<div class="section level3">
<h3 id="backgating-and-overlays">Backgating and overlays<a class="anchor" aria-label="anchor" href="#backgating-and-overlays"></a>
</h3>
<p>There are instances when you may want to visualize a gated population
(children/grandchildren/siblings) together with the parent. This is the
idea behind backgating. We have already seen met this approach above
using <code>geom_overlay</code> where density of 1 node was project on
top of density of a different unrelated node.</p>
<p>Below, we go through another example where we ask the question: what
is the general expression level of CD4 and CD8a on MAIT cells compared
to all CD3+ T cells?</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mait_expression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto.html" class="external-link">ggcyto</a></span><span class="op">(</span><span class="va">gs</span>,</span>
<span>                          subset <span class="op">=</span> <span class="st">"CD3+ T cells"</span>,</span>
<span>                          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"CD4"</span>, y <span class="op">=</span> <span class="st">"CD8a"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html" class="external-link">geom_hex</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">256</span><span class="op">)</span><span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/geom_overlay.html" class="external-link">geom_overlay</a></span><span class="op">(</span>data <span class="op">=</span> </span>
<span>                                  <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gh_pop_get_data.html" class="external-link">gs_pop_get_data</a></span><span class="op">(</span><span class="va">gs</span>, <span class="st">"MAIT Cells"</span><span class="op">)</span>,</span>
<span>                                size <span class="op">=</span> <span class="fl">0.5</span>, colour <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/axis_x_inverse_trans.html" class="external-link">axis_x_inverse_trans</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/axis_x_inverse_trans.html" class="external-link">axis_y_inverse_trans</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"MAIT Cells (red) overlaid on top of all conventional T Cells"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mait_expression</span>  </span></code></pre></div>
<p><img src="ggcyto_1-5_files/figure-html/ggcyto_gs_geom_overlay-1.png" width="960"></p>
<p>Seems like there are a lot of MAIT Cells that are CD8a+ or negative
for both CD8a and CD4 compared to CD4+.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p><code>ggcyto</code> is an extremely flexible and powerful tool to
explore and visualize flow cytometry data. [WRITE MORE!]</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew McDavid, Arpan Neupan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
