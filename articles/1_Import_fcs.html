<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Importing and Basics of working with FCS files • CytoverseBioc2023</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Importing and Basics of working with FCS files">
<meta property="og:description" content="CytoverseBioc2023">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CytoverseBioc2023</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9007</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/1_Import_fcs.html">Importing and Basics of working with FCS files</a>
    </li>
    <li>
      <a href="../articles/2_Spillover_transformation.html">Spillover, Transformation, and Visualization</a>
    </li>
    <li>
      <a href="../articles/3_Gating_1.html">Gating Cells with scripts</a>
    </li>
    <li>
      <a href="../articles/4_Gating_gatingTemplate.html">Gating Cells with gatingTemplates</a>
    </li>
    <li>
      <a href="../articles/5_ggcyto.html">Visualizations using ggcyto</a>
    </li>
    <li>
      <a href="../articles/6_Reporting.html">Reporting: Counts, Frequency, etc.</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OzetteTech/cytoverse-bioc-2023" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Importing and Basics of working with FCS
files</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OzetteTech/cytoverse-bioc-2023/blob/HEAD/vignettes/1_Import_fcs.Rmd" class="external-link"><code>vignettes/1_Import_fcs.Rmd</code></a></small>
      <div class="hidden name"><code>1_Import_fcs.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Flow cytometry data (regardless of the type of instrument used) is
generally saved as a <strong>.fcs</strong> file. This file is populated
with raw data, fluorescence intensity (for optics based technologies)
and abundance (for mass cytrometry), as well as various metadata
including: <em>user id</em>, <em>instrument id</em>, <em>dynamic range
of instrument</em>, etc. It is important to be able to interact with and
manipulate the <strong>.fcs</strong> file as it gives the users/analysts
fine grain control!</p>
</div>
<div class="section level2">
<h2 id="installingloading-required-libraries">Installing/loading required libraries<a class="anchor" aria-label="anchor" href="#installingloading-required-libraries"></a>
</h2>
<p>In the workshop, all the cytoverse packages are included in the
instance you launched on the Bioconductor Workshop Galaxy, and the
docker image this uses will remain available indefinitely (see the <a href="https://cdn.ozetteai.com/cytoverse-bioc-2023/index.html#notes-on-using-the-docker-image-1">README.md</a>
for details). That said, if you want to install and use
<code>cytoverse</code> packages outside of docker, the standard
Bioconductor tooling works:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"cytolib"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"flowCore"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"flowWorkspace"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"ggcyto"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"openCyto"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"flowStats"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"CytoML"</span><span class="op">)</span></span></code></pre></div>
<p>For the moment, we only need to load <code>flowCore</code> and
<code>flowWorkspace</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowCore</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">flowWorkspace</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cdn.ozetteai.com/cytoverse-bioc-2023/index.html">CytoverseBioc2023</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cache_workshop_data.html">cache_workshop_data</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="flowrepository-workshop-data">FlowRepository workshop data<a class="anchor" aria-label="anchor" href="#flowrepository-workshop-data"></a>
</h2>
<p>In this <code>cytoverse</code> workshop we will demonstrate the use
of <code>cytoverse</code> packages to analyse publicly available
datasets hosted on <a href="http://flowrepository.org/" class="external-link">FlowRepository</a>. The first dataset
<a href="http://flowrepository.org/id/FR-FCM-ZZEC" class="external-link">FR-FCM-ZZEC</a>
contains FCS files for OMIP-025, a study to evaluate the memory and
follicular helper phenotypes of human T- and NK- cell populations using
intracellular cytokine staining. The second dataset <a href="http://flowrepository.org/id/FR-FCM-ZZ36" class="external-link">FR-FCM-ZZ36</a> contains
FCS files for OMIP-018, a study designed to phenotype T cells for
expression of various chemokine receptors.</p>
<p>The data required for this workshop, including subsets extracted from
the FlowRepository datasets are made available locally in a file cache
by running <code><a href="../reference/cache_workshop_data.html">cache_workshop_data()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="cytoverse-data-structures-for--fcs-files">
<code>cytoverse</code> data structures for <strong>.fcs</strong>
files<a class="anchor" aria-label="anchor" href="#cytoverse-data-structures-for--fcs-files"></a>
</h2>
<p>There are four <strong>main</strong> data structures that represent
flow cytometry data in <code>cytoverse</code>: <code>cytoframe</code>,
<code>cytoset</code>, <code>GatingHierarchy</code> and
<code>GatingSet</code>.</p>
<ul>
<li>
<code>cytoframe</code>: a single <strong>.fcs</strong> file,</li>
<li>
<code>cytoset</code>: a list like object that can store multiple
<strong>.fcs</strong> files,</li>
<li>
<code>GatingHierarchy</code>: a list like object that allows
building and attaching gates and filter to a <code>cytoframe</code>
</li>
<li>
<code>GatingSet</code>: a list like object that allows building and
attaching gates and filter to a <code>cytoset</code>
</li>
</ul>
<p>Some of these have overlapping functionality, and we’ll eventually
explain when you would prefer one data structure to another as we
continue through this workshop.</p>
<em>Note:</em>
<details><em>There are additional legacy data structures called
<code>flowFrame</code> and <code>flowSet</code> in
<code>cytoverse</code> that are analogous to <code>cytoframe</code> and
<code>cytoset</code> in function. We will not use these data structures
in this workshop.</em>
</details>
</div>
<div class="section level2">
<h2 id="reading-in-fcs-files">Reading in FCS files<a class="anchor" aria-label="anchor" href="#reading-in-fcs-files"></a>
</h2>
<p>There are two preferred approaches to read in <strong>.fcs</strong>
file(s) into R:</p>
<ul>
<li>Read in individual <strong>.fcs</strong> files as
<code>cytoframe</code>,</li>
<li>Read in a set of <strong>.fcs</strong> files as
<code>cytoset</code>,</li>
</ul>
<p>(Additionally, you can read a workspace generated with another tool,
such as FlowJo, using the <code>CytoML</code> package.)</p>
<p>The function <code>load_cytoframe_from_fcs</code> is used to read in
individual file as a <code>cytoframe</code> object.</p>
<p>Normally, you might download a folder with a set of FCS files and
interact with that. For instance,</p>
<p><img src="images/example_fcs_path.png" width="386"></p>
<p>For technical reasons, we can’t easily distribute the
<strong>.fcs</strong> files in this way for this workshop, but instead
reference them through a file cache. This cache is essentially a set of
folders, however, and we specify which files we want in it with
<code>get_workshop_data</code>.</p>
<p>If you want to explore it, you can examine it with
<code>BiocFileCache::bfcinfo(CytoverseBioc2023:::.get_cache())</code> or
you can see some additional details below:</p>
<details><div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># structure of cached workshop data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">/</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>├── FlowRepository_FR<span class="sc">-</span>FCM<span class="sc">-</span>ZZ36_files</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_APC Stained Control.fcs</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_APC<span class="sc">-</span>Cy7 Stained Control.fcs</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_Alexa Fluor <span class="dv">405</span> Stained Control.fcs</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_Alexa Fluor <span class="dv">430</span> Stained Control.fcs</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_Alexa Fluor <span class="dv">488</span> Stained Control.fcs</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_PE Stained Control.fcs</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_PE<span class="sc">-</span>Cy5 Stained Control.fcs</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_PE<span class="sc">-</span>Cy5<span class="dv">-5</span> Stained Control.fcs</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_PE<span class="sc">-</span>Cy7 Stained Control.fcs</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_PE<span class="sc">-</span>Texas Red Stained Control.fcs</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_PerCP<span class="sc">-</span>Cy5<span class="dv">-5</span> Stained Control.fcs</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_Qdot <span class="dv">605</span> Stained Control.fcs</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_Qdot <span class="dv">655</span> Stained Control.fcs</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_Qdot <span class="dv">800</span> Stained Control.fcs</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>│   ├── Compensation Controls_Unstained Control.fcs</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>│   ├── control_files.csv</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>│   ├── pbmc_luca.fcs</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>│   └── spillover_from_FJ.csv</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>├── fcs_data</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>│   ├── 4000_BDC<span class="sc">-</span>CR1.fcs</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>│   ├── 4000_TNK<span class="sc">-</span>CR1.fcs</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>│   ├── 4001_BDC<span class="sc">-</span>CR1.fcs</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>│   ├── 4001_TNK<span class="sc">-</span>CR1.fcs</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>│   ├── 4002_TNK<span class="sc">-</span>CR1.fcs</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>│   └── 4003_TNK<span class="sc">-</span>CR1.fcs</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>├── fj_wsp</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>│   ├── 210224_BDC_CR1_analysis_template.wsp</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>│   ├── 210224_BDC_CR2_analysis_template.wsp</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>│   ├── 210224_TNK<span class="sc">-</span>CR2_analysis_template.wsp</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>│   ├── 210520_TNK<span class="sc">-</span>CR1_analysis_template.wsp</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>│   ├── analysis_copy.wsp</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>│   └── fj_transform.gz</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>├── gating_template</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>│   └── gating_template_TNK.csv</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>└── metadata</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    └── 220115_Demographics_for_raw_data_upload.csv</span></code></pre></div>
<p>Throughout this workshop we will use <code><a href="../reference/cache_workshop_data.html">get_workshop_data()</a></code>
to return information about the location of the cached files so that
they can be easily accessed for downstream analyses.
<code><a href="../reference/cache_workshop_data.html">get_workshop_data()</a></code> returns a tibble containing information
about the cached data including the path to the requested file(s) as
indicated in the <code>rpath</code> variable.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get location of cached data</span></span>
<span><span class="va">cache_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cache_workshop_data.html">get_workshop_data</a></span><span class="op">(</span><span class="st">"gating_template_TNK.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cache_info</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "rid"                "rname"              "create_time"       </span></span>
<span><span class="co">##  [4] "access_time"        "rpath"              "rtype"             </span></span>
<span><span class="co">##  [7] "fpath"              "last_modified_time" "etag"              </span></span>
<span><span class="co">## [10] "expires"</span></span></code></pre>
</details><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/load_cytoframe_from_fcs.html" class="external-link">load_cytoframe_from_fcs</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/cache_workshop_data.html">get_workshop_data</a></span><span class="op">(</span></span>
<span>    <span class="st">"data/fcs_data/4000_TNK-CR1.fcs"</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">rpath</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a cytoframe object</span></span>
<span><span class="va">cf</span></span></code></pre></div>
<pre><code><span><span class="co">## cytoframe object '5c571a0f37_4000_TNK-CR1.fcs'</span></span>
<span><span class="co">## with 102015 cells and 33 observables:</span></span>
<span><span class="co">##                   name            desc     range  minRange  maxRange</span></span>
<span><span class="co">## $P1              FSC-A              NA    262143    0.0000    262143</span></span>
<span><span class="co">## $P2              FSC-H              NA    262143    0.0000    262143</span></span>
<span><span class="co">## $P3              SSC-A              NA    262143    0.0000    262143</span></span>
<span><span class="co">## $P4             B515-A    TCR Vd1 FITC    262143  -15.6344    262143</span></span>
<span><span class="co">## $P5             B610-A     CD127 BB630    262143  -28.6509    262143</span></span>
<span><span class="co">## ...                ...             ...       ...       ...       ...</span></span>
<span><span class="co">## $P29            V710-A TCR Va7_2 BV711    262143  -56.8302    262143</span></span>
<span><span class="co">## $P30            V750-A    CX3CR1 BV750    262143  -94.4459    262143</span></span>
<span><span class="co">## $P31            V785-A      CD27 BV786    262143  -68.9282    262143</span></span>
<span><span class="co">## $P32 remove_from_FS_FM              QC    262143    0.0000    262143</span></span>
<span><span class="co">## $P33              Time              NA        93    0.0000        93</span></span>
<span><span class="co">## 327 keywords are stored in the 'description' slot</span></span>
<span><span class="co">## row names(0):</span></span></code></pre>
<p>The <code>cytoframe</code> object has 3 slots where various data is
stored.</p>
<ul>
<li>
<code>exprs(cf)</code> stores the expression matrix (i.e. the
collected data),</li>
<li>
<code>parameters(cf)</code> stores information pertaining to
channels: channel name, marker description,and data ranges as an
AnnotatedDataFrame,</li>
<li>
<code>keyword(cf)</code> stores additional information extracted
from the <strong>.fcs</strong> file header. The file header follow ISAC
guidelines. Visit <a href="https://isac-net.org/page/Data-Standards" class="external-link">here</a> for more
information.</li>
</ul>
</div>
<div class="section level2">
<h2 id="working-with-cytoframe-objects">Working with <code>cytoframe</code> objects<a class="anchor" aria-label="anchor" href="#working-with-cytoframe-objects"></a>
</h2>
<p>A few useful definitions that help us get oriented with the
underlying data in the <code>cytoframe</code> object.</p>
<ul>
<li>
<strong>Channels</strong>: Instrument derived labels of various
parameters that were measured. Channels are the column names of the
<code>cytoframe</code>. Any data generated from the same instrument will
have the same (similar) Channel names.</li>
<li>
<strong>Markers</strong>: User provided labels for various
parameters that were measured. For example: Channel name: B710-A, Marker
name: CD3 (in <code>cf</code>). Marker names are set by the users and
may not be unique across experiments/users. Not all channels are markers
– some are physical parameters such as the forward scatter or side
scatter. These channels will have their marker names set to
<code>NA</code>.</li>
<li>
<strong>Expression</strong>: Measured values. A matrix where every
row is an event (frequently a cell) and every column is a channel.</li>
</ul>
<p>Working with a <code>cytoframe</code> object is very similar to
working with a <code>data.frame</code> in R, where a “row” is a cell and
a “column” is a channel. In particular, subsetting with square brackets
<code>cf[i,j]</code> or <code>cf$</code> works as you might hope. An
important difference, however, is that unlike most other functions in R,
the subset and assignment operations <strong>DO NOT</strong> create a
new copy of the data but simply provides an updated “view” of the data.
Because this is quite unlike the rest of R, we will perseverate on this
point.</p>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<div class="section level4">
<h4 id="accessing-parameter-summary-and-metadata">Accessing parameter summary and metadata<a class="anchor" aria-label="anchor" href="#accessing-parameter-summary-and-metadata"></a>
</h4>
<p>Summary of measured parameters.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/parameters-methods.html" class="external-link">parameters</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># show as a dataframe</span></span></code></pre></div>
<pre><code><span><span class="co">##                   name               desc  range  minRange maxRange</span></span>
<span><span class="co">## $P1              FSC-A               &lt;NA&gt; 262143   0.00000   262143</span></span>
<span><span class="co">## $P2              FSC-H               &lt;NA&gt; 262143   0.00000   262143</span></span>
<span><span class="co">## $P3              SSC-A               &lt;NA&gt; 262143   0.00000   262143</span></span>
<span><span class="co">## $P4             B515-A       TCR Vd1 FITC 262143 -15.63437   262143</span></span>
<span><span class="co">## $P5             B610-A        CD127 BB630 262143 -28.65089   262143</span></span>
<span><span class="co">## $P6             B660-A          PD1 BB660 262143 -27.92371   262143</span></span>
<span><span class="co">## $P7             B710-A         CD16 BB700 262143 -59.19245   262143</span></span>
<span><span class="co">## $P8             B780-A        CXCR5 BB790 262143 -43.04906   262143</span></span>
<span><span class="co">## $P9             G575-A         TCR Vg9 PE 262143 -56.83300   262143</span></span>
<span><span class="co">## $P10            G610-A   TCR Vd2 PE-CF594 262143 -41.95899   262143</span></span>
<span><span class="co">## $P11            G660-A       CD161 PE-Cy5 262143 -80.99514   262143</span></span>
<span><span class="co">## $P12            G710-A     HLA-DR PE-Cy55 262143 -18.96598   262143</span></span>
<span><span class="co">## $P13            G780-A        CCR1 PE-Cy7 262143 -36.50302   262143</span></span>
<span><span class="co">## $P14            R670-A CD1d:PBS57 tet APC 262143 -29.70142   262143</span></span>
<span><span class="co">## $P15            R730-A       CD45RA Ax700 262143 -25.40188   262143</span></span>
<span><span class="co">## $P16            R780-A   XCR1 APC-Fire750 262143 -44.47800   262143</span></span>
<span><span class="co">## $P17            U390-A        CCR3 BUV395 262143 -34.30737   262143</span></span>
<span><span class="co">## $P18            U450-A  Live Dead UV Blue 262143 -33.85764   262143</span></span>
<span><span class="co">## $P19            U500-A        CCR7 BUV496 262143 -41.69565   262143</span></span>
<span><span class="co">## $P20            U570-A        CD56 BUV563 262143 -55.82978   262143</span></span>
<span><span class="co">## $P21            U660-A        CD39 BUV661 262143 -40.15375   262143</span></span>
<span><span class="co">## $P22            U740-A        CD95 BUV737 262143 -61.74041   262143</span></span>
<span><span class="co">## $P23            U785-A         CD4 BUV805 262143 -80.50024   262143</span></span>
<span><span class="co">## $P24            V450-A         CCR2 BV421 262143 -15.04627   262143</span></span>
<span><span class="co">## $P25            V510-A          CD3 BV510 262143 -47.88375   262143</span></span>
<span><span class="co">## $P26            V570-A         CD8a BV570 262143 -26.94096   262143</span></span>
<span><span class="co">## $P27            V605-A         CD38 BV605 262143 -24.60269   262143</span></span>
<span><span class="co">## $P28            V655-A         CCR5 BV650 262143 -29.68589   262143</span></span>
<span><span class="co">## $P29            V710-A    TCR Va7_2 BV711 262143 -56.83018   262143</span></span>
<span><span class="co">## $P30            V750-A       CX3CR1 BV750 262143 -94.44585   262143</span></span>
<span><span class="co">## $P31            V785-A         CD27 BV786 262143 -68.92819   262143</span></span>
<span><span class="co">## $P32 remove_from_FS_FM                 QC 262143   0.00000   262143</span></span>
<span><span class="co">## $P33              Time               &lt;NA&gt;     93   0.00000       93</span></span></code></pre>
<p>Various metadata present in the <strong>.fcs</strong> files.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># keywords</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/keyword-methods.html" class="external-link">keyword</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="co"># only show the first 10</span></span></code></pre></div>
<pre><code><span><span class="co">## $FCSversion</span></span>
<span><span class="co">## [1] "3"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`$FIL`</span></span>
<span><span class="co">## [1] "4000_TNK-CR1.fcs"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`$TOT`</span></span>
<span><span class="co">## [1] "102015"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`$PAR`</span></span>
<span><span class="co">## [1] "33"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`$BYTEORD`</span></span>
<span><span class="co">## [1] "4,3,2,1"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`$DATATYPE`</span></span>
<span><span class="co">## [1] "F"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $FJ_FCS_VERSION</span></span>
<span><span class="co">## [1] "3"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`$BEGINANALYSIS`</span></span>
<span><span class="co">## [1] "0"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`$BEGINSTEXT`</span></span>
<span><span class="co">## [1] "0"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`$BTIM`</span></span>
<span><span class="co">## [1] "12:36:14"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="channels-expression-and-subsets">Channels, Expression, and Subsets<a class="anchor" aria-label="anchor" href="#channels-expression-and-subsets"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># channels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "FSC-A"             "FSC-H"             "SSC-A"            </span></span>
<span><span class="co">##  [4] "B515-A"            "B610-A"            "B660-A"           </span></span>
<span><span class="co">##  [7] "B710-A"            "B780-A"            "G575-A"           </span></span>
<span><span class="co">## [10] "G610-A"            "G660-A"            "G710-A"           </span></span>
<span><span class="co">## [13] "G780-A"            "R670-A"            "R730-A"           </span></span>
<span><span class="co">## [16] "R780-A"            "U390-A"            "U450-A"           </span></span>
<span><span class="co">## [19] "U500-A"            "U570-A"            "U660-A"           </span></span>
<span><span class="co">## [22] "U740-A"            "U785-A"            "V450-A"           </span></span>
<span><span class="co">## [25] "V510-A"            "V570-A"            "V605-A"           </span></span>
<span><span class="co">## [28] "V655-A"            "V710-A"            "V750-A"           </span></span>
<span><span class="co">## [31] "V785-A"            "remove_from_FS_FM" "Time"</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># markernames</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               B515-A               B610-A               B660-A </span></span>
<span><span class="co">##       "TCR Vd1 FITC"        "CD127 BB630"          "PD1 BB660" </span></span>
<span><span class="co">##               B710-A               B780-A               G575-A </span></span>
<span><span class="co">##         "CD16 BB700"        "CXCR5 BB790"         "TCR Vg9 PE" </span></span>
<span><span class="co">##               G610-A               G660-A               G710-A </span></span>
<span><span class="co">##   "TCR Vd2 PE-CF594"       "CD161 PE-Cy5"     "HLA-DR PE-Cy55" </span></span>
<span><span class="co">##               G780-A               R670-A               R730-A </span></span>
<span><span class="co">##        "CCR1 PE-Cy7" "CD1d:PBS57 tet APC"       "CD45RA Ax700" </span></span>
<span><span class="co">##               R780-A               U390-A               U450-A </span></span>
<span><span class="co">##   "XCR1 APC-Fire750"        "CCR3 BUV395"  "Live Dead UV Blue" </span></span>
<span><span class="co">##               U500-A               U570-A               U660-A </span></span>
<span><span class="co">##        "CCR7 BUV496"        "CD56 BUV563"        "CD39 BUV661" </span></span>
<span><span class="co">##               U740-A               U785-A               V450-A </span></span>
<span><span class="co">##        "CD95 BUV737"         "CD4 BUV805"         "CCR2 BV421" </span></span>
<span><span class="co">##               V510-A               V570-A               V605-A </span></span>
<span><span class="co">##          "CD3 BV510"         "CD8a BV570"         "CD38 BV605" </span></span>
<span><span class="co">##               V655-A               V710-A               V750-A </span></span>
<span><span class="co">##         "CCR5 BV650"    "TCR Va7_2 BV711"       "CX3CR1 BV750" </span></span>
<span><span class="co">##               V785-A    remove_from_FS_FM </span></span>
<span><span class="co">##         "CD27 BV786"                 "QC"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># instrument channel ranges</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cf</span>, type <span class="op">=</span> <span class="st">"instrument"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      FSC-A  FSC-H  SSC-A       B515-A       B610-A       B660-A       B710-A</span></span>
<span><span class="co">## min      0      0      0    -15.63437    -28.65089    -27.92371    -59.19245</span></span>
<span><span class="co">## max 262143 262143 262143 262143.00000 262143.00000 262143.00000 262143.00000</span></span>
<span><span class="co">##           B780-A     G575-A       G610-A       G660-A       G710-A       G780-A</span></span>
<span><span class="co">## min    -43.04906    -56.833    -41.95899    -80.99514    -18.96598    -36.50302</span></span>
<span><span class="co">## max 262143.00000 262143.000 262143.00000 262143.00000 262143.00000 262143.00000</span></span>
<span><span class="co">##           R670-A       R730-A     R780-A       U390-A       U450-A       U500-A</span></span>
<span><span class="co">## min    -29.70142    -25.40188    -44.478    -34.30737    -33.85764    -41.69565</span></span>
<span><span class="co">## max 262143.00000 262143.00000 262143.000 262143.00000 262143.00000 262143.00000</span></span>
<span><span class="co">##           U570-A       U660-A       U740-A       U785-A       V450-A</span></span>
<span><span class="co">## min    -55.82978    -40.15375    -61.74041    -80.50024    -15.04627</span></span>
<span><span class="co">## max 262143.00000 262143.00000 262143.00000 262143.00000 262143.00000</span></span>
<span><span class="co">##           V510-A       V570-A       V605-A       V655-A       V710-A</span></span>
<span><span class="co">## min    -47.88375    -26.94096    -24.60269    -29.68589    -56.83018</span></span>
<span><span class="co">## max 262143.00000 262143.00000 262143.00000 262143.00000 262143.00000</span></span>
<span><span class="co">##           V750-A       V785-A remove_from_FS_FM Time</span></span>
<span><span class="co">## min    -94.44585    -68.92819                 0    0</span></span>
<span><span class="co">## max 262143.00000 262143.00000            262143   93</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># expression</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##          FSC-A    FSC-H    SSC-A   B515-A    B610-A</span></span>
<span><span class="co">## [1,] 103038.81 88791.99 519.6562 345.1194 2290.9805</span></span>
<span><span class="co">## [2,]  94411.01 79966.73 926.6454 327.2972 2667.8779</span></span>
<span><span class="co">## [3,]  93067.27 76786.17 917.7739 335.5514 2857.0173</span></span>
<span><span class="co">## [4,]  94072.62 87279.86 337.3925 252.7754  895.4494</span></span>
<span><span class="co">## [5,] 102544.66 81934.16 626.8440 760.3972 2160.2334</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of events</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 102015</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of channels </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 33</span></span></code></pre>
<p>Notice that there is a correspondence between channels, markers, and
the expression matrix. i.e. the <code>names</code> of the named vector
<code>markernames(cf)</code> are a subset of the columns of the
expression matrix <code>exprs(cf)</code> as well as the columns of the
<code>cytoframe</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># interested marker: CD4</span></span>
<span><span class="co"># easy to find which channel is mapped to CD4</span></span>
<span><span class="va">CD4_chan</span> <span class="op">&lt;-</span> <span class="fu">flowCore</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/getChannelMarker.html" class="external-link">getChannelMarker</a></span><span class="op">(</span></span>
<span>  frm <span class="op">=</span> <span class="va">cf</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"CD4"</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">name</span></span>
<span></span>
<span><span class="co"># inspect CD4_chan</span></span>
<span><span class="va">CD4_chan</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "U785-A"</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract expression of cd4</span></span>
<span><span class="va">e_cd4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf</span><span class="op">[</span>, <span class="va">CD4_chan</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">e_cd4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         U785-A</span></span>
<span><span class="co">## [1,] 2191.3669</span></span>
<span><span class="co">## [2,] 2586.0300</span></span>
<span><span class="co">## [3,] 3177.3501</span></span>
<span><span class="co">## [4,]  486.9400</span></span>
<span><span class="co">## [5,]  691.0447</span></span>
<span><span class="co">## [6,]  556.0515</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset cytorame by column</span></span>
<span><span class="va">s_cf</span> <span class="op">&lt;-</span> <span class="va">cf</span><span class="op">[</span>, <span class="va">CD4_chan</span><span class="op">]</span></span>
<span><span class="va">s_cf</span></span></code></pre></div>
<pre><code><span><span class="co">## cytoframe object '5c571a0f37_4000_TNK-CR1.fcs'</span></span>
<span><span class="co">## with 102015 cells and 1 observables:</span></span>
<span><span class="co">##        name       desc     range  minRange  maxRange</span></span>
<span><span class="co">## $P23 U785-A CD4 BUV805    262143  -80.5002    262143</span></span>
<span><span class="co">## 327 keywords are stored in the 'description' slot</span></span>
<span><span class="co">## row names(0):</span></span>
<span><span class="co">## cytoframe has been subsetted and can be realized through 'realize_view()'.</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset cytoframe by row</span></span>
<span><span class="va">s2_cf</span> <span class="op">&lt;-</span> <span class="va">cf</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="op">]</span></span>
<span><span class="va">s2_cf</span></span></code></pre></div>
<pre><code><span><span class="co">## cytoframe object '5c571a0f37_4000_TNK-CR1.fcs'</span></span>
<span><span class="co">## with 100 cells and 33 observables:</span></span>
<span><span class="co">##                   name            desc     range  minRange  maxRange</span></span>
<span><span class="co">## $P1              FSC-A              NA    262143    0.0000    262143</span></span>
<span><span class="co">## $P2              FSC-H              NA    262143    0.0000    262143</span></span>
<span><span class="co">## $P3              SSC-A              NA    262143    0.0000    262143</span></span>
<span><span class="co">## $P4             B515-A    TCR Vd1 FITC    262143  -15.6344    262143</span></span>
<span><span class="co">## $P5             B610-A     CD127 BB630    262143  -28.6509    262143</span></span>
<span><span class="co">## ...                ...             ...       ...       ...       ...</span></span>
<span><span class="co">## $P29            V710-A TCR Va7_2 BV711    262143  -56.8302    262143</span></span>
<span><span class="co">## $P30            V750-A    CX3CR1 BV750    262143  -94.4459    262143</span></span>
<span><span class="co">## $P31            V785-A      CD27 BV786    262143  -68.9282    262143</span></span>
<span><span class="co">## $P32 remove_from_FS_FM              QC    262143    0.0000    262143</span></span>
<span><span class="co">## $P33              Time              NA        93    0.0000        93</span></span>
<span><span class="co">## 327 keywords are stored in the 'description' slot</span></span>
<span><span class="co">## row names(0):</span></span>
<span><span class="co">## cytoframe has been subsetted and can be realized through 'realize_view()'.</span></span></code></pre>
<p>Notice that the subset (<code>&lt;- [</code>) operation can be
applied directly to the <code>cytoframe</code> object so that
information regarding the file is preserved. Also, as indicated above,
these operations provide an aliased view of the data without creating a
<strong>copy</strong>.</p>
<p>Below, we show examples of how to manipulate the
<code>cytoframe</code> object and create a copy using
<code><a href="https://rdrr.io/pkg/flowWorkspace/man/cytoframe.html" class="external-link">realize_view()</a></code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a new markername</span></span>
<span><span class="va">new_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"U785-A"</span> <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a new cytoframe subset</span></span>
<span><span class="va">cf_sub</span> <span class="op">&lt;-</span> <span class="va">cf</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">150</span>, <span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cytoframe.html" class="external-link">realize_view</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># realize_view creates a new cytoframe, distinct from the original</span></span>
<span></span>
<span><span class="co"># old markernames</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">cf_sub</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               B515-A               B610-A               B660-A </span></span>
<span><span class="co">##       "TCR Vd1 FITC"        "CD127 BB630"          "PD1 BB660" </span></span>
<span><span class="co">##               B710-A               B780-A               G575-A </span></span>
<span><span class="co">##         "CD16 BB700"        "CXCR5 BB790"         "TCR Vg9 PE" </span></span>
<span><span class="co">##               G610-A               G660-A               G710-A </span></span>
<span><span class="co">##   "TCR Vd2 PE-CF594"       "CD161 PE-Cy5"     "HLA-DR PE-Cy55" </span></span>
<span><span class="co">##               G780-A               R670-A               R730-A </span></span>
<span><span class="co">##        "CCR1 PE-Cy7" "CD1d:PBS57 tet APC"       "CD45RA Ax700" </span></span>
<span><span class="co">##               R780-A               U390-A               U450-A </span></span>
<span><span class="co">##   "XCR1 APC-Fire750"        "CCR3 BUV395"  "Live Dead UV Blue" </span></span>
<span><span class="co">##               U500-A               U570-A               U660-A </span></span>
<span><span class="co">##        "CCR7 BUV496"        "CD56 BUV563"        "CD39 BUV661" </span></span>
<span><span class="co">##               U740-A               U785-A               V450-A </span></span>
<span><span class="co">##        "CD95 BUV737"         "CD4 BUV805"         "CCR2 BV421" </span></span>
<span><span class="co">##               V510-A               V570-A               V605-A </span></span>
<span><span class="co">##          "CD3 BV510"         "CD8a BV570"         "CD38 BV605" </span></span>
<span><span class="co">##               V655-A               V710-A               V750-A </span></span>
<span><span class="co">##         "CCR5 BV650"    "TCR Va7_2 BV711"       "CX3CR1 BV750" </span></span>
<span><span class="co">##               V785-A    remove_from_FS_FM </span></span>
<span><span class="co">##         "CD27 BV786"                 "QC"</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set new markername</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">cf_sub</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">new_name</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">cf_sub</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               B515-A               B610-A               B660-A </span></span>
<span><span class="co">##       "TCR Vd1 FITC"        "CD127 BB630"          "PD1 BB660" </span></span>
<span><span class="co">##               B710-A               B780-A               G575-A </span></span>
<span><span class="co">##         "CD16 BB700"        "CXCR5 BB790"         "TCR Vg9 PE" </span></span>
<span><span class="co">##               G610-A               G660-A               G710-A </span></span>
<span><span class="co">##   "TCR Vd2 PE-CF594"       "CD161 PE-Cy5"     "HLA-DR PE-Cy55" </span></span>
<span><span class="co">##               G780-A               R670-A               R730-A </span></span>
<span><span class="co">##        "CCR1 PE-Cy7" "CD1d:PBS57 tet APC"       "CD45RA Ax700" </span></span>
<span><span class="co">##               R780-A               U390-A               U450-A </span></span>
<span><span class="co">##   "XCR1 APC-Fire750"        "CCR3 BUV395"  "Live Dead UV Blue" </span></span>
<span><span class="co">##               U500-A               U570-A               U660-A </span></span>
<span><span class="co">##        "CCR7 BUV496"        "CD56 BUV563"        "CD39 BUV661" </span></span>
<span><span class="co">##               U740-A               U785-A               V450-A </span></span>
<span><span class="co">##        "CD95 BUV737"               "test"         "CCR2 BV421" </span></span>
<span><span class="co">##               V510-A               V570-A               V605-A </span></span>
<span><span class="co">##          "CD3 BV510"         "CD8a BV570"         "CD38 BV605" </span></span>
<span><span class="co">##               V655-A               V710-A               V750-A </span></span>
<span><span class="co">##         "CCR5 BV650"    "TCR Va7_2 BV711"       "CX3CR1 BV750" </span></span>
<span><span class="co">##               V785-A    remove_from_FS_FM </span></span>
<span><span class="co">##         "CD27 BV786"                 "QC"</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># manipulating expression values</span></span>
<span><span class="co"># notice the data range </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cf_sub</span><span class="op">[</span>, <span class="st">"U785-A"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           U785-A</span></span>
<span><span class="co">## min    -80.50024</span></span>
<span><span class="co">## max 262143.00000</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualise original channel ditribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf_sub</span><span class="op">[</span>, <span class="st">"U785-A"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"U785-A"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="1_Import_fcs_files/figure-html/manipulate_flowFrame-1.png" width="700"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># asinh transform</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf_sub</span><span class="op">)</span><span class="op">[</span>, <span class="st">"U785-A"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html" class="external-link">asinh</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf_sub</span><span class="op">)</span><span class="op">[</span>, <span class="st">"U785-A"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># notice the data range after transformation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span></span>
<span>  <span class="va">cf_sub</span><span class="op">[</span>, <span class="st">"U785-A"</span><span class="op">]</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"instrument"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           U785-A</span></span>
<span><span class="co">## min    -80.50024</span></span>
<span><span class="co">## max 262143.00000</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualise channel distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf_sub</span><span class="op">[</span>, <span class="st">"U785-A"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"U785-A"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="1_Import_fcs_files/figure-html/manipulate_flowFrame-2.png" width="700"></p>
<p>Notice that the data range summary was not updated when we used
<code>&lt;-</code> to change the underlying expression matrix. A good
practice is to use <code>transform</code> function to transform the
underlying expression matrix. Importantly, <code>transform</code> also
updates the data range summary. Moreover, <code>transform</code> can
also be used to add new columns to the <code>cytoframe</code>.</p>
<p><em>Note</em>: We will go over <code>transformations</code> in a
later section.</p>
</div>
</div>
<div class="section level3">
<h3 id="exercise">Exercise<a class="anchor" aria-label="anchor" href="#exercise"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Why is <code>length(colnames(cf))</code> different than
<code>length(markernames(cf))</code>?</li>
<li>How could you create a random downsample of 1000 cells from
<code>cf</code>?</li>
<li>Make a scatter plot of the forward scatter (<code>FSC-A</code>) vs
side scatter (<code>SSC-A</code>) of <code>cf</code> using a graphics
package of your choice.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="reading-in-a-set-of-fcs-files-as-a-cytoset">Reading in a set of FCS files as a <code>cytoset</code><a class="anchor" aria-label="anchor" href="#reading-in-a-set-of-fcs-files-as-a-cytoset"></a>
</h2>
<p>In a experimental sense, a single <strong>.fcs</strong> file is not
very interesting, since this represents only a single sample. To draw
any conclusions, we’ll want replicates. When there are a set of
<strong>.fcs</strong> files they can be loaded into R either as a
<code>cytoset</code>.</p>
<p><strong>cytoset</strong>: A collection of <strong>.fcs</strong>
files, preferably, but not necessarily from the same
panel/experiment.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/load_cytoset_from_fcs.html" class="external-link">load_cytoset_from_fcs</a></span><span class="op">(</span></span>
<span>  files <span class="op">=</span> <span class="fu"><a href="../reference/cache_workshop_data.html">get_workshop_data</a></span><span class="op">(</span></span>
<span>    path <span class="op">=</span> <span class="st">"data/fcs_data/"</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">rpath</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cs</span></span></code></pre></div>
<pre><code><span><span class="co">## A cytoset with 6 samples.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   column names:</span></span>
<span><span class="co">##     FSC-A, FSC-H, SSC-A, B515-A, B610-A, B660-A, B710-A, B780-A, G575-A, G610-A, G660-A, G710-A, G780-A, R670-A, R730-A, R780-A, U390-A, U450-A, U500-A, U570-A, U660-A, U740-A, U785-A, V450-A, V510-A, V570-A, V605-A, V655-A, V710-A, V750-A, V785-A, remove_from_FS_FM, Time</span></span></code></pre>
<p>A <code>cytoset</code> can also be indexed with square brackets
<code>cs[i,j]</code>, however now the row index <code>i</code> selects
samples (<strong>individual FCS files</strong>) rather than cells. A
<code>cytoset</code> also behaves like a list – a double bracket
<code>cs[[i]]</code> selects a single sample as a
<code>cytoframe</code>.</p>
<p>Generally, each FCS file replicate has unique metadata properties
that can (<strong>and should</strong>) be supplied to the
<code>cytoset</code>. These can be added after loading the
<code>cytoset</code> by using <code>pData(x) &lt;- data.frame</code>.
The <code>rownames</code> of the data.frame <strong>must match</strong>
the <code>sampleNames</code> of the <code>cytoset</code>.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prior to providing metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                                                      name</span></span>
<span><span class="co">## 5c566982051_4000_BDC-CR1.fcs 5c566982051_4000_BDC-CR1.fcs</span></span>
<span><span class="co">## 5c571a0f37_4000_TNK-CR1.fcs   5c571a0f37_4000_TNK-CR1.fcs</span></span>
<span><span class="co">## 5c5158ad61d_4001_BDC-CR1.fcs 5c5158ad61d_4001_BDC-CR1.fcs</span></span>
<span><span class="co">## 5c537ac7bab_4001_TNK-CR1.fcs 5c537ac7bab_4001_TNK-CR1.fcs</span></span>
<span><span class="co">## 5c5476d5f1f_4002_TNK-CR1.fcs 5c5476d5f1f_4002_TNK-CR1.fcs</span></span>
<span><span class="co">## 5c53ed7d81c_4003_TNK-CR1.fcs 5c53ed7d81c_4003_TNK-CR1.fcs</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create metadata</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Untreated"</span>,<span class="st">"Treated"</span><span class="op">)</span>,</span>
<span>    length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  panel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span></span>
<span>      pattern <span class="op">=</span> <span class="st">"TNK"</span>,</span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/featureNames.html" class="external-link">sampleNames</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"T Cell Panel"</span>,</span>
<span>    <span class="st">"Myeloid Panel"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s see what happens when <code>rownames</code> do not match!</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># try to add metadata  -- this leads to an error</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">metadata</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: Invalid input type, expected 'character' actual 'integer'</span></span></code></pre>
<p>Now, we ensure that <code>rownames</code> of data.frame matches
<code>sampleNames</code> of the <code>cytoset</code>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># now it works</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/featureNames.html" class="external-link">sampleNames</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                              Treatment         panel</span></span>
<span><span class="co">## 5c566982051_4000_BDC-CR1.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## 5c571a0f37_4000_TNK-CR1.fcs    Treated  T Cell Panel</span></span>
<span><span class="co">## 5c5158ad61d_4001_BDC-CR1.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## 5c537ac7bab_4001_TNK-CR1.fcs   Treated  T Cell Panel</span></span>
<span><span class="co">## 5c5476d5f1f_4002_TNK-CR1.fcs Untreated  T Cell Panel</span></span>
<span><span class="co">## 5c53ed7d81c_4003_TNK-CR1.fcs   Treated  T Cell Panel</span></span></code></pre>
<p>The benefit of having metadata is that we can use many of the
sub-setting operations in a metadata specific manner.</p>
<p>This is much more convenient than going back and forth between the
full set of files.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset by files that have myeloid staining panel without creating a copy of the data</span></span>
<span><span class="va">cs_myeloid</span> <span class="op">&lt;-</span> <span class="va">cs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span><span class="op">[[</span><span class="st">"panel"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Myeloid Panel"</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">cs_myeloid</span></span></code></pre></div>
<pre><code><span><span class="co">## A cytoset with 2 samples.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   column names:</span></span>
<span><span class="co">##     FSC-A, FSC-H, SSC-A, B515-A, B610-A, B660-A, B710-A, B780-A, G575-A, G610-A, G660-A, G710-A, G780-A, R670-A, R730-A, R780-A, U390-A, U450-A, U500-A, U570-A, U660-A, U740-A, U785-A, V450-A, V510-A, V570-A, V605-A, V655-A, V710-A, V750-A, V785-A, remove_from_FS_FM, Time</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">cs_myeloid</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                              Treatment         panel</span></span>
<span><span class="co">## 5c566982051_4000_BDC-CR1.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## 5c5158ad61d_4001_BDC-CR1.fcs Untreated Myeloid Panel</span></span></code></pre>
<div class="section level3">
<h3 id="cytoset-views-and-aliasing">Cytoset views and aliasing<a class="anchor" aria-label="anchor" href="#cytoset-views-and-aliasing"></a>
</h3>
<p>Many of the sub-setting operation for <code>cytoframe</code> are also
applicable for <code>cytoset</code>. Similar to <code>cytoframe</code>
sub-setting operations only create a new “view” of the data. For a
complete copy of the data, <code>realize_view</code> should be used.</p>
<p>Below is an example of <code>cytoset</code> sub-setting which also
highlights how the operations performed on <code>cytoset</code> affects
the underlying data.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># demonstrate how cs point to the same underlying data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[[</span><span class="fl">1</span>, <span class="st">"B515-A"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          B515-A</span></span>
<span><span class="co">## min   -110.3859</span></span>
<span><span class="co">## max 262143.0000</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset and show prior to transformation</span></span>
<span><span class="va">cs_small</span> <span class="op">&lt;-</span> <span class="va">cs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cs_small</span><span class="op">[[</span><span class="fl">1</span>, <span class="st">"B515-A"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          B515-A</span></span>
<span><span class="co">## min   -110.3859</span></span>
<span><span class="co">## max 262143.0000</span></span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a transformList</span></span>
<span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transformList-class.html" class="external-link">transformList</a></span><span class="op">(</span><span class="st">"B515-A"</span>,<span class="va">asinh</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transform</span></span>
<span><span class="va">cs_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">cs_small</span>,<span class="va">trans</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># after transformation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cs_small</span><span class="op">[[</span><span class="fl">1</span>, <span class="st">"B515-A"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        B515-A</span></span>
<span><span class="co">## min -5.397151</span></span>
<span><span class="co">## max 13.169792</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># whole cs </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[[</span><span class="fl">1</span>, <span class="st">"B515-A"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        B515-A</span></span>
<span><span class="co">## min -5.397151</span></span>
<span><span class="co">## max 13.169792</span></span></code></pre>
<p>As you see, the transformation was applied to a subset
<code>cs_small</code> however the original <code>cs</code> was also
altered highlighting that both objects were pointing to the same data.
To confirm this, you can use <code>cs_get_uri</code> or
<code>cf_get_uri</code>:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cs_get_uri.html" class="external-link">cs_get_uri</a></span><span class="op">(</span><span class="va">cs_small</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/tmp/RtmpeNtbap/7d74d081-0880-4376-8d26-89df9812122c"</span></span></code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cs_get_uri.html" class="external-link">cs_get_uri</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/tmp/RtmpeNtbap/7d74d081-0880-4376-8d26-89df9812122c"</span></span></code></pre>
<p>To perform a <strong>deep copy</strong> we can use
<code><a href="https://rdrr.io/pkg/flowWorkspace/man/cytoframe.html" class="external-link">realize_view()</a></code></p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># look at underlying expression</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[[</span><span class="fl">2</span>, <span class="st">"B515-A"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           B515-A</span></span>
<span><span class="co">## min    -15.63437</span></span>
<span><span class="co">## max 262143.00000</span></span></code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset and show prior to transformation</span></span>
<span><span class="va">cs_small2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cytoframe.html" class="external-link">realize_view</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cs_small2</span><span class="op">[[</span><span class="fl">1</span>, <span class="st">"B515-A"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           B515-A</span></span>
<span><span class="co">## min    -15.63437</span></span>
<span><span class="co">## max 262143.00000</span></span></code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a transformList</span></span>
<span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transformList-class.html" class="external-link">transformList</a></span><span class="op">(</span><span class="st">"B515-A"</span>,<span class="va">asinh</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transform</span></span>
<span><span class="va">cs_small2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">cs_small2</span>,<span class="va">trans</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># after transformation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cs_small2</span><span class="op">[[</span><span class="fl">1</span>, <span class="st">"B515-A"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       B515-A</span></span>
<span><span class="co">## min -3.44364</span></span>
<span><span class="co">## max 13.16979</span></span></code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># whole cs </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[[</span><span class="fl">2</span>, <span class="st">"B515-A"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           B515-A</span></span>
<span><span class="co">## min    -15.63437</span></span>
<span><span class="co">## max 262143.00000</span></span></code></pre>
<p>Notice that <code>cs</code> is left unchanged.</p>
</div>
<div class="section level3">
<h3 id="exercise-1">Exercise<a class="anchor" aria-label="anchor" href="#exercise-1"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Explain why the following code does not work as expected:</li>
</ol>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cf_log_trans</span> <span class="op">&lt;-</span> <span class="va">cf</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf_log_trans</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span><span class="op">[</span>,<span class="st">"V510-A"</span><span class="op">]</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cf_log_trans</span><span class="op">)</span><span class="op">[</span>,<span class="st">"V510-A"</span><span class="op">]</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Effect of log2 transformation on  V510-A (CD3)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="adding-additional--fcs-files-to-cytoset">Adding additional <strong>.fcs</strong> files to
<code>cytoset</code><a class="anchor" aria-label="anchor" href="#adding-additional--fcs-files-to-cytoset"></a>
</h2>
<p>Lastly, we can also add additional <strong>.fcs</strong> files to a
<code>cytoset</code> using <code>cs_add_cytoframe</code>.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add to cytoset</span></span>
<span><span class="va">cs_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cytoframe.html" class="external-link">realize_view</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># cs[1] subsets cs into a cytoset while realize_view leads to a deep_copy into a new cytoset</span></span>
<span><span class="va">cs_small</span></span></code></pre></div>
<pre><code><span><span class="co">## A cytoset with 1 samples.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   column names:</span></span>
<span><span class="co">##     FSC-A, FSC-H, SSC-A, B515-A, B610-A, B660-A, B710-A, B780-A, G575-A, G610-A, G660-A, G710-A, G780-A, R670-A, R730-A, R780-A, U390-A, U450-A, U500-A, U570-A, U660-A, U740-A, U785-A, V450-A, V510-A, V570-A, V605-A, V655-A, V710-A, V750-A, V785-A, remove_from_FS_FM, Time</span></span></code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># no need to assign back to cs_small, because this function operates by reference and returns NULL anyways.</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cs_add_cytoframe.html" class="external-link">cs_add_cytoframe</a></span><span class="op">(</span></span>
<span>  cs <span class="op">=</span> <span class="va">cs_small</span>,</span>
<span>  sn <span class="op">=</span> <span class="st">"Sample Name"</span>,</span>
<span>  cf <span class="op">=</span> <span class="va">cs</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>   <span class="co"># cs[[3]] results in a cytoframe</span></span>
<span><span class="op">)</span> </span>
<span><span class="va">cs_small</span></span></code></pre></div>
<pre><code><span><span class="co">## A cytoset with 2 samples.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   column names:</span></span>
<span><span class="co">##     FSC-A, FSC-H, SSC-A, B515-A, B610-A, B660-A, B710-A, B780-A, G575-A, G610-A, G660-A, G710-A, G780-A, R670-A, R730-A, R780-A, U390-A, U450-A, U500-A, U570-A, U660-A, U740-A, U785-A, V450-A, V510-A, V570-A, V605-A, V655-A, V710-A, V750-A, V785-A, remove_from_FS_FM, Time</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="from-cytoset-to-cytoframe">From <code>cytoset</code> to <code>cytoframe</code><a class="anchor" aria-label="anchor" href="#from-cytoset-to-cytoframe"></a>
</h2>
<p>It is possible that you may want to extract a <code>cytoframe</code>
or extract all files as a list of <code>cytoframe</code>. We can either
use <code>[[</code> to directly grab a <code>cytoframe</code> or
<code>cytoset_to_list</code>.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract a single cytoframe by using cs[[index/samplename]]</span></span>
<span><span class="va">single_cf</span> <span class="op">&lt;-</span> <span class="va">cs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># convert to a list</span></span>
<span><span class="va">list_of_cf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/convert.html" class="external-link">cytoset_to_list</a></span><span class="op">(</span><span class="va">cs</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="list-like-operation-with-cytoset">List like operation with <code>cytoset</code><a class="anchor" aria-label="anchor" href="#list-like-operation-with-cytoset"></a>
</h2>
<p>As indicated previously, a <code>cytoset</code> behaves like a list.
To leverage this behaviour we can use <code>fsApply</code> to iterate
through the samples in a <code>cytoset</code>. By default, output is
attempted to be coerced to a single array like object. (Set
<code>simplify = FALSE</code> to return another list.)</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># getting number of rows (cells) of individual cytoframes</span></span>
<span><span class="va">n_cell_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/fsApply.html" class="external-link">fsApply</a></span><span class="op">(</span><span class="va">cs</span>, <span class="va">nrow</span><span class="op">)</span></span>
<span><span class="va">n_cell_events</span></span></code></pre></div>
<pre><code><span><span class="co">##                                [,1]</span></span>
<span><span class="co">## 5c566982051_4000_BDC-CR1.fcs 912254</span></span>
<span><span class="co">## 5c571a0f37_4000_TNK-CR1.fcs  102015</span></span>
<span><span class="co">## 5c5158ad61d_4001_BDC-CR1.fcs 924474</span></span>
<span><span class="co">## 5c537ac7bab_4001_TNK-CR1.fcs  92703</span></span>
<span><span class="co">## 5c5476d5f1f_4002_TNK-CR1.fcs 372224</span></span>
<span><span class="co">## 5c53ed7d81c_4003_TNK-CR1.fcs 146150</span></span></code></pre>
<div class="section level3">
<h3 id="exercises">Exercises<a class="anchor" aria-label="anchor" href="#exercises"></a>
</h3>
<ol style="list-style-type: decimal">
<li>How would you extract marker names that are stored within a the
cytoset <code>cs</code>?</li>
<li>How would you create a <code>cytoset</code> from the object
<code>list_of_cf</code>?</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="saving-your-data">Saving your data<a class="anchor" aria-label="anchor" href="#saving-your-data"></a>
</h2>
<p>Saving your data is easy.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save cytoframe</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cf_write_disk.html" class="external-link">cf_write_disk</a></span><span class="op">(</span><span class="va">cf</span>, <span class="st">"path/to/my_new_cf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save cytoset</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/save_cytoset.html" class="external-link">save_cytoset</a></span><span class="op">(</span><span class="va">cs</span>, path <span class="op">=</span> <span class="st">"path/to/my/cs"</span><span class="op">)</span></span></code></pre></div>
<p>Loading it back is just as easy.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load cytoframe</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/load_cytoframe.html" class="external-link">load_cytoframe</a></span><span class="op">(</span><span class="st">"path/to/my_cf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load cytoset</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/save_cytoset.html" class="external-link">load_cytoset</a></span><span class="op">(</span><span class="st">"path/to/my/cs"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>We went through multiple ways to import, interact with, and
manipulate <strong>.fcs</strong> files using the <code>cytoverse</code>
tools. It is important to note additional functionality, <em>which we
will not going to go over at this workshop for the sake of time</em>,
for further manipulation and even creation of <strong>.fcs</strong>
files exist with the <code>cytoverse</code>. We encourage you to explore
them further at your leisure by calling
<code>browseVignettes("packagename")</code>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew McDavid, Arpan Neupane.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
