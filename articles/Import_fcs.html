<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Importing and Basics of working with FCS files • CytoverseBioc2023</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Importing and Basics of working with FCS files">
<meta property="og:description" content="CytoverseBioc2023">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CytoverseBioc2023</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Bioc2023_Cytoverse.html">Reproducible and programmatic analysis of flow cytometry experiments with the cytoverse</a>
    </li>
    <li>
      <a href="../articles/Gating_1.html">Gating Cells in cytoverse</a>
    </li>
    <li>
      <a href="../articles/HOWTO_BUILD_WORKSHOP.html">How To Build A Workshop Package</a>
    </li>
    <li>
      <a href="../articles/Import_fcs.html">Importing and Basics of working with FCS files</a>
    </li>
    <li>
      <a href="../articles/Reporting_1.html">Reporting: Bringing Everything Together</a>
    </li>
    <li>
      <a href="../articles/Spillover_v2.html">Spillover, compensation, Transformations, and Visualization</a>
    </li>
    <li>
      <a href="../articles/ggcyto_1-5.html">Visualization (1.5)</a>
    </li>
    <li>
      <a href="../articles/workshop_example.html">An Example Workshop</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OzetteTech/cytoverse-bioc-2023" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Importing and Basics of working with FCS
files</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OzetteTech/cytoverse-bioc-2023/blob/HEAD/vignettes/Import_fcs.Rmd" class="external-link"><code>vignettes/Import_fcs.Rmd</code></a></small>
      <div class="hidden name"><code>Import_fcs.Rmd</code></div>

    </div>

    
    
<p>Flow cytometry data (regardless of the type of instrument used) is
generally saved as a <strong>.fcs</strong> file. This file is populated
with various parameters: such as userid, instrumentid,</p>
<div class="section level2">
<h2 id="installingloading-required-libraries">Installing/loading required libraries<a class="anchor" aria-label="anchor" href="#installingloading-required-libraries"></a>
</h2>
<p>Start by installing and loading the Cytoverse package
<strong>flowCore</strong> hosted at <strong>bioconductor.org</strong>.
This package allows us to read and manipulate the <strong>.fcs</strong>
file in R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BioManager"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"flowCore"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"flowCore"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ozettetech.github.io/cytoverse-bioc-2023/">CytoverseBioc2023</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Biobase</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: BiocGenerics</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'BiocGenerics'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:flowCore':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     normalize</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     IQR, mad, sd, var, xtabs</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     anyDuplicated, aperm, append, as.data.frame, basename, cbind,</span></span>
<span><span class="co">##     colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,</span></span>
<span><span class="co">##     get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,</span></span>
<span><span class="co">##     match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,</span></span>
<span><span class="co">##     Position, rank, rbind, Reduce, rownames, sapply, setdiff, sort,</span></span>
<span><span class="co">##     table, tapply, union, unique, unsplit, which.max, which.min</span></span></code></pre>
<pre><code><span><span class="co">## Welcome to Bioconductor</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Vignettes contain introductory material; view with</span></span>
<span><span class="co">##     'browseVignettes()'. To cite Bioconductor, see</span></span>
<span><span class="co">##     'citation("Biobase")', and for packages 'citation("pkgname")'.</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: flowWorkspace</span></span></code></pre>
<pre><code><span><span class="co">## As part of improvements to flowWorkspace, some behavior of</span></span>
<span><span class="co">## GatingSet objects has changed. For details, please read the section</span></span>
<span><span class="co">## titled "The cytoframe and cytoset classes" in the package vignette:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   vignette("flowWorkspace-Introduction", "flowWorkspace")</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: ggcyto</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: ggplot2</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: ncdfFlow</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: BH</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: openCyto</span></span></code></pre>
<pre><code><span><span class="co">## Warning: replacing previous import 'flowViz::contour' by 'graphics::contour'</span></span>
<span><span class="co">## when loading 'flowStats'</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cache_workshop_data.html">cache_workshop_data</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-in-fcs-files">Reading in FCS files<a class="anchor" aria-label="anchor" href="#reading-in-fcs-files"></a>
</h2>
<p>There are 3 approaches to read in FCS files:</p>
<ul>
<li>Read in individual files as <strong>flowFrame</strong>
</li>
<li>Read in a set of FCS files as <strong>flowSet</strong>
</li>
<li>Read in a set of FCS files as <strong>cytoset</strong>
</li>
</ul>
<p><em>Note: We will revisit flowSet and cytoset</em></p>
<p>The function <code>read.FCS</code> is used to read in individual
files as a <code>flowFrame</code> object.</p>
<p>Normally, you might download a folder with a set of FCS files and
interact with that. For instance,</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"images/example_fcs_path.png"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/example_fcs_path.png" width="386"></p>
<p>For technical reasons, we can’t easily distribute the FCS files in
this way, but instead reference them through a file cache that is
populated once. But this is just a glorified set of folders. If you want
to explore it, you can examine it with
<code>BiocFileCache::bfcquery(CytoverseBioc2023::bfc)</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/read.FCS.html" class="external-link">read.FCS</a></span><span class="op">(</span><span class="fu"><a href="../reference/cache_workshop_data.html">get_workshop_data</a></span><span class="op">(</span><span class="st">"data/fcs_data/4000_TNK-CR1.fcs"</span><span class="op">)</span><span class="op">$</span><span class="va">rpath</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a flowFrame object</span></span>
<span><span class="va">ff</span></span></code></pre></div>
<pre><code><span><span class="co">## flowFrame object '210217_COVID-CR_TNK-CR1_Run 1_Samples_Plate 1_A1_A01_001.fcs'</span></span>
<span><span class="co">## with 102015 cells and 33 observables:</span></span>
<span><span class="co">##                   name            desc     range  minRange  maxRange</span></span>
<span><span class="co">## $P1              FSC-A              NA    262144    0.0000    262144</span></span>
<span><span class="co">## $P2              FSC-H              NA    262144    0.0000    262144</span></span>
<span><span class="co">## $P3              SSC-A              NA    262144    0.0000    262144</span></span>
<span><span class="co">## $P4             B515-A    TCR Vd1 FITC    262144  -15.6344    262144</span></span>
<span><span class="co">## $P5             B610-A     CD127 BB630    262144  -28.6509    262144</span></span>
<span><span class="co">## ...                ...             ...       ...       ...       ...</span></span>
<span><span class="co">## $P29            V710-A TCR Va7_2 BV711    262144  -56.8302    262144</span></span>
<span><span class="co">## $P30            V750-A    CX3CR1 BV750    262144  -94.4459    262144</span></span>
<span><span class="co">## $P31            V785-A      CD27 BV786    262144  -68.9282    262144</span></span>
<span><span class="co">## $P32 remove_from_FS_FM              QC    262144    0.0000    262144</span></span>
<span><span class="co">## $P33              Time              NA        94    0.0000     20000</span></span>
<span><span class="co">## 326 keywords are stored in the 'description' slot</span></span></code></pre>
<p>The <code>flowFrame</code> object has 3 slots where various data is
stored.</p>
<ul>
<li>
<code>@exprs</code> stores the expression matrix (i.e. the collected
data). Can be accessed via <code>exprs(ff)</code>
</li>
<li>
<code>@parameters</code> stores information pertaining to channels:
channel name, marker description,and data ranges as AnnotatedDataFrame.
Can be accessed via <code>parameters(ff)</code>
</li>
<li>
<code>@description</code> stores additional information extracted
from the FCS file header. The FCS file header follow ISAC guidelines.
Visit <a href="https://isac-net.org/page/Data-Standards" class="external-link">here</a> for
more information. Can be accessed via <code>description(ff)</code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="working-with-flowframe">Working with <code>flowFrame</code><a class="anchor" aria-label="anchor" href="#working-with-flowframe"></a>
</h2>
<p>Working with a <code>flowFrame</code> object is going to be very
similar to working with a <code>dataframe</code> in R.</p>
<p>A few useful definitions that help us get oriented with the
underlying data in the <code>flowFrame</code> object.</p>
<p><strong>Channels</strong>: Instrument derived labels of various
parameters that were measured. Channels are the column names of the
<code>flowFrame</code>. Any data generated from the same instrument will
have the same (similar) Channel names. <strong>Markers</strong>: User
provided labels for various parameters that were measured. For example:
Channel name: B710-A, Marker name: CD3. Marker names are set by the
users, may not be unique across experiments/users.
<strong>Expression</strong>: Measured values. A matrix where every row
is an event (frequently a cell) and every column is a channel.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># channels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "FSC-A"             "FSC-H"             "SSC-A"            </span></span>
<span><span class="co">##  [4] "B515-A"            "B610-A"            "B660-A"           </span></span>
<span><span class="co">##  [7] "B710-A"            "B780-A"            "G575-A"           </span></span>
<span><span class="co">## [10] "G610-A"            "G660-A"            "G710-A"           </span></span>
<span><span class="co">## [13] "G780-A"            "R670-A"            "R730-A"           </span></span>
<span><span class="co">## [16] "R780-A"            "U390-A"            "U450-A"           </span></span>
<span><span class="co">## [19] "U500-A"            "U570-A"            "U660-A"           </span></span>
<span><span class="co">## [22] "U740-A"            "U785-A"            "V450-A"           </span></span>
<span><span class="co">## [25] "V510-A"            "V570-A"            "V605-A"           </span></span>
<span><span class="co">## [28] "V655-A"            "V710-A"            "V750-A"           </span></span>
<span><span class="co">## [31] "V785-A"            "remove_from_FS_FM" "Time"</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># markernames</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               B515-A               B610-A               B660-A </span></span>
<span><span class="co">##       "TCR Vd1 FITC"        "CD127 BB630"          "PD1 BB660" </span></span>
<span><span class="co">##               B710-A               B780-A               G575-A </span></span>
<span><span class="co">##         "CD16 BB700"        "CXCR5 BB790"         "TCR Vg9 PE" </span></span>
<span><span class="co">##               G610-A               G660-A               G710-A </span></span>
<span><span class="co">##   "TCR Vd2 PE-CF594"       "CD161 PE-Cy5"     "HLA-DR PE-Cy55" </span></span>
<span><span class="co">##               G780-A               R670-A               R730-A </span></span>
<span><span class="co">##        "CCR1 PE-Cy7" "CD1d:PBS57 tet APC"       "CD45RA Ax700" </span></span>
<span><span class="co">##               R780-A               U390-A               U450-A </span></span>
<span><span class="co">##   "XCR1 APC-Fire750"        "CCR3 BUV395"  "Live Dead UV Blue" </span></span>
<span><span class="co">##               U500-A               U570-A               U660-A </span></span>
<span><span class="co">##        "CCR7 BUV496"        "CD56 BUV563"        "CD39 BUV661" </span></span>
<span><span class="co">##               U740-A               U785-A               V450-A </span></span>
<span><span class="co">##        "CD95 BUV737"         "CD4 BUV805"         "CCR2 BV421" </span></span>
<span><span class="co">##               V510-A               V570-A               V605-A </span></span>
<span><span class="co">##          "CD3 BV510"         "CD8a BV570"         "CD38 BV605" </span></span>
<span><span class="co">##               V655-A               V710-A               V750-A </span></span>
<span><span class="co">##         "CCR5 BV650"    "TCR Va7_2 BV711"       "CX3CR1 BV750" </span></span>
<span><span class="co">##               V785-A    remove_from_FS_FM </span></span>
<span><span class="co">##         "CD27 BV786"                 "QC"</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># expression</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##          FSC-A    FSC-H    SSC-A   B515-A    B610-A</span></span>
<span><span class="co">## [1,] 103038.81 88791.99 519.6562 345.1194 2290.9805</span></span>
<span><span class="co">## [2,]  94411.01 79966.73 926.6454 327.2972 2667.8779</span></span>
<span><span class="co">## [3,]  93067.27 76786.17 917.7739 335.5514 2857.0173</span></span>
<span><span class="co">## [4,]  94072.62 87279.86 337.3925 252.7754  895.4494</span></span>
<span><span class="co">## [5,] 102544.66 81934.16 626.8440 760.3972 2160.2334</span></span></code></pre>
<p>Notice that there is a correspondence between channels, markers, and
the expression matrix. i.e. the <code>names</code> of the named vector
<code>markernames(ff)</code> are a subset of the columns of the
expression matrix <code>exprs(ff)</code> as well as the columns of the
<code>flowFrame</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># interested marker: CD4</span></span>
<span><span class="va">marker_cd4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"CD4 "</span>,x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">marker_cd4</span></span></code></pre></div>
<pre><code><span><span class="co">##       U785-A </span></span>
<span><span class="co">## "CD4 BUV805"</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract expression of cd4</span></span>
<span><span class="va">e_cd4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">marker_cd4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">e_cd4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2191.3669 2586.0300 3177.3501  486.9400  691.0447  556.0515</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset flowFrame by column</span></span>
<span><span class="va">s_ff</span> <span class="op">&lt;-</span> <span class="va">ff</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">marker_cd4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">s_ff</span></span></code></pre></div>
<pre><code><span><span class="co">## flowFrame object '210217_COVID-CR_TNK-CR1_Run 1_Samples_Plate 1_A1_A01_001.fcs'</span></span>
<span><span class="co">## with 102015 cells and 1 observables:</span></span>
<span><span class="co">##        name       desc     range  minRange  maxRange</span></span>
<span><span class="co">## $P23 U785-A CD4 BUV805    262144  -80.5002    262144</span></span>
<span><span class="co">## 326 keywords are stored in the 'description' slot</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset flowFrame by row</span></span>
<span><span class="va">s2_ff</span> <span class="op">&lt;-</span> <span class="va">ff</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="op">]</span></span>
<span><span class="va">s2_ff</span></span></code></pre></div>
<pre><code><span><span class="co">## flowFrame object '210217_COVID-CR_TNK-CR1_Run 1_Samples_Plate 1_A1_A01_001.fcs'</span></span>
<span><span class="co">## with 100 cells and 33 observables:</span></span>
<span><span class="co">##                   name            desc     range  minRange  maxRange</span></span>
<span><span class="co">## $P1              FSC-A              NA    262144    0.0000    262144</span></span>
<span><span class="co">## $P2              FSC-H              NA    262144    0.0000    262144</span></span>
<span><span class="co">## $P3              SSC-A              NA    262144    0.0000    262144</span></span>
<span><span class="co">## $P4             B515-A    TCR Vd1 FITC    262144  -15.6344    262144</span></span>
<span><span class="co">## $P5             B610-A     CD127 BB630    262144  -28.6509    262144</span></span>
<span><span class="co">## ...                ...             ...       ...       ...       ...</span></span>
<span><span class="co">## $P29            V710-A TCR Va7_2 BV711    262144  -56.8302    262144</span></span>
<span><span class="co">## $P30            V750-A    CX3CR1 BV750    262144  -94.4459    262144</span></span>
<span><span class="co">## $P31            V785-A      CD27 BV786    262144  -68.9282    262144</span></span>
<span><span class="co">## $P32 remove_from_FS_FM              QC    262144    0.0000    262144</span></span>
<span><span class="co">## $P33              Time              NA        94    0.0000     20000</span></span>
<span><span class="co">## 326 keywords are stored in the 'description' slot</span></span></code></pre>
<p>Notice that the subset operation can be applied directly to the
<code>flowFrame</code> object so that information regarding the file is
preserved.</p>
<p>Often <code>&lt;-</code> can be used to manipulate the
<code>flowFrame</code> object.</p>
<p>Example:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a new markername</span></span>
<span><span class="va">new_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"U785-A"</span> <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># old markernames</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">s_ff</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       U785-A </span></span>
<span><span class="co">## "CD4 BUV805"</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set new markername</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">s_ff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">new_name</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/markernames.html" class="external-link">markernames</a></span><span class="op">(</span><span class="va">s_ff</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## U785-A </span></span>
<span><span class="co">## "test"</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># manipulating expression values</span></span>
<span><span class="co"># notice the data range </span></span>
<span><span class="va">s_ff</span></span></code></pre></div>
<pre><code><span><span class="co">## flowFrame object '210217_COVID-CR_TNK-CR1_Run 1_Samples_Plate 1_A1_A01_001.fcs'</span></span>
<span><span class="co">## with 102015 cells and 1 observables:</span></span>
<span><span class="co">##        name   desc     range  minRange  maxRange</span></span>
<span><span class="co">## $P23 U785-A   test    262144  -80.5002    262144</span></span>
<span><span class="co">## 326 keywords are stored in the 'description' slot</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">s_ff</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Import_fcs_files/figure-html/manipulate_flowFrame-1.png" width="700"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># transform</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">s_ff</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">s_ff</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span></span>
<span></span>
<span><span class="co"># notice the data range after transformation</span></span>
<span><span class="va">s_ff</span></span></code></pre></div>
<pre><code><span><span class="co">## flowFrame object '210217_COVID-CR_TNK-CR1_Run 1_Samples_Plate 1_A1_A01_001.fcs'</span></span>
<span><span class="co">## with 102015 cells and 1 observables:</span></span>
<span><span class="co">##        name   desc     range  minRange  maxRange</span></span>
<span><span class="co">## $P23 U785-A   test    262144  -80.5002    262144</span></span>
<span><span class="co">## 326 keywords are stored in the 'description' slot</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">s_ff</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Import_fcs_files/figure-html/manipulate_flowFrame-2.png" width="700"></p>
<p>Notice that the data range was not updated when we used
<code>&lt;-</code> to change the underlying expression matrix. A good
practice is to use <code>transform</code> function to transform the
underlying expression matrix. Moreover, <code>transform</code> can also
be used to add new columns to the <code>flowFrame</code>.</p>
<p>Example</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define the transformation</span></span>
<span><span class="va">simple_trans</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="va">x</span><span class="op">/</span><span class="fl">100</span></span>
<span></span>
<span><span class="co"># create a transformList</span></span>
<span><span class="co"># this indicates which columns to transform and what transformation to do</span></span>
<span><span class="va">t_list</span> <span class="op">&lt;-</span> <span class="fu">flowCore</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transformList-class.html" class="external-link">transformList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"U785-A"</span><span class="op">)</span>,<span class="va">simple_trans</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># before transformation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">s_ff</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           U785-A</span></span>
<span><span class="co">## min    -80.50024</span></span>
<span><span class="co">## max 262144.00000</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># after transformation</span></span>
<span><span class="va">s_ff_trans</span> <span class="op">&lt;-</span> <span class="fu">flowCore</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">s_ff</span>,</span>
<span>                                  <span class="va">t_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">s_ff_trans</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           U785-A</span></span>
<span><span class="co">## min   -0.8050024</span></span>
<span><span class="co">## max 2621.4400000</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add a new column</span></span>
<span><span class="va">s_ff_trans</span> <span class="op">&lt;-</span> <span class="fu">flowCore</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">s_ff</span>,<span class="st">"New_col"</span> <span class="op">=</span> <span class="fu">simple_trans</span><span class="op">(</span><span class="va">`U785-A`</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s_ff_trans</span></span></code></pre></div>
<pre><code><span><span class="co">## flowFrame object '210217_COVID-CR_TNK-CR1_Run 1_Samples_Plate 1_A1_A01_001.fcs'</span></span>
<span><span class="co">## with 102015 cells and 2 observables:</span></span>
<span><span class="co">##         name                   desc     range   minRange  maxRange</span></span>
<span><span class="co">## $P23  U785-A                   test    262144 -80.500244 262144.00</span></span>
<span><span class="co">## $P2  New_col derived from transfo..    262144  -0.805002   2621.44</span></span>
<span><span class="co">## 326 keywords are stored in the 'description' slot</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="reading-in-a-set-of-fcs-files-as-flowset-or-cytoset">Reading in a set of FCS files as <code>flowSet</code> or
<code>cytoset</code><a class="anchor" aria-label="anchor" href="#reading-in-a-set-of-fcs-files-as-flowset-or-cytoset"></a>
</h2>
<p>In an experimental sense, a single FCS file is not very interesting
(of course, this is not always true!). When there are a set of FCS files
they can be loaded into R either as a <code>flowSet</code> or a
<code>cytoset</code>.</p>
<p><strong>flowSet/cytoset</strong>: A collection of FCS files,
preferably, but not necessarily from the same panel/experiment.</p>
<p><em>Note: difference between <code>flowSet</code> and
<code>cytoset</code> is the underlying representation of the data.
<code>cytoset</code> is implemented in the package
<code>flowWorkspace</code> which we will encounter in more detail later.
Additionally, <code>cytoset</code> is built upon a collection of
<code>cytoframe</code>, analogous to <code>flowFrame</code>.</em></p>
<p>Options to create <code>flowSet</code></p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># steps to create flowSet</span></span>
<span></span>
<span><span class="co"># option 1</span></span>
<span><span class="co"># load fcs files as a list</span></span>
<span><span class="va">fcs_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="../reference/cache_workshop_data.html">get_workshop_data</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data/fcs_data/"</span><span class="op">)</span><span class="op">$</span><span class="va">rpath</span>,FUN <span class="op">=</span> <span class="va">read.FCS</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to flowSet</span></span>
<span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">fcs_list</span>,<span class="st">"flowSet"</span><span class="op">)</span></span>
<span><span class="va">fs</span></span></code></pre></div>
<pre><code><span><span class="co">## A flowSet with 16 experiments.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## column names(33): FSC-A FSC-H ... remove_from_FS_FM Time</span></span></code></pre>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># option 2 (preferred)</span></span>
<span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/read.flowSet.html" class="external-link">read.flowSet</a></span><span class="op">(</span>files <span class="op">=</span> <span class="fu"><a href="../reference/cache_workshop_data.html">get_workshop_data</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data/fcs_data/"</span><span class="op">)</span><span class="op">$</span><span class="va">rpath</span><span class="op">)</span></span>
<span><span class="va">fs</span></span></code></pre></div>
<pre><code><span><span class="co">## A flowSet with 16 experiments.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## column names(33): FSC-A FSC-H ... remove_from_FS_FM Time</span></span></code></pre>
<p>Options to create a <code>cytoset</code></p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">flowWorkspace</span><span class="op">)</span></span>
<span><span class="co"># option 1 (preferred)</span></span>
<span><span class="va">cs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/load_cytoset_from_fcs.html" class="external-link">load_cytoset_from_fcs</a></span><span class="op">(</span>files <span class="op">=</span> <span class="fu"><a href="../reference/cache_workshop_data.html">get_workshop_data</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data/fcs_data/"</span><span class="op">)</span><span class="op">$</span><span class="va">rpath</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># option 2 (convert flowSet to cytoset)</span></span>
<span><span class="va">cs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/convert.html" class="external-link">flowSet_to_cytoset</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span></span>
<span><span class="va">cs</span></span></code></pre></div>
<pre><code><span><span class="co">## A cytoset with 16 samples.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   column names:</span></span>
<span><span class="co">##     FSC-A, FSC-H, SSC-A, B515-A, B610-A, B660-A, B710-A, B780-A, G575-A, G610-A, G660-A, G710-A, G780-A, R670-A, R730-A, R780-A, U390-A, U450-A, U500-A, U570-A, U660-A, U740-A, U785-A, V450-A, V510-A, V570-A, V605-A, V655-A, V710-A, V750-A, V785-A, remove_from_FS_FM, Time</span></span></code></pre>
<p>Generally, each experiment has unique metadata properties that can
(and should) be supplied to the <code>flowSet</code> and
<code>cytoset</code>. These can be added to by using
<code>pData(x) &lt;- data.frame</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create metadata</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/featureNames.html" class="external-link">sampleNames</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span>,</span>
<span>                       Treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Untreated"</span>,<span class="st">"Treated"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                       panel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"TNK"</span>,x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/featureNames.html" class="external-link">sampleNames</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span><span class="op">)</span>,<span class="st">"T Cell Panel"</span>,<span class="st">"Myeloid Panel"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prior to providing metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                                                      name</span></span>
<span><span class="co">## b97615bf0a5_4000_BDC-CR1.fcs b97615bf0a5_4000_BDC-CR1.fcs</span></span>
<span><span class="co">## b9711543845_4000_BDC-CR2.fcs b9711543845_4000_BDC-CR2.fcs</span></span>
<span><span class="co">## b977d45bce0_4000_TNK-CR1.fcs b977d45bce0_4000_TNK-CR1.fcs</span></span>
<span><span class="co">## b9748bb2acf_4000_TNK-CR2.fcs b9748bb2acf_4000_TNK-CR2.fcs</span></span>
<span><span class="co">## b972c30fdef_4001_BDC-CR1.fcs b972c30fdef_4001_BDC-CR1.fcs</span></span>
<span><span class="co">## b973f63eb39_4001_BDC-CR2.fcs b973f63eb39_4001_BDC-CR2.fcs</span></span>
<span><span class="co">## b972b7e203_4001_TNK-CR1.fcs   b972b7e203_4001_TNK-CR1.fcs</span></span>
<span><span class="co">## b9770c0c3ee_4001_TNK-CR2.fcs b9770c0c3ee_4001_TNK-CR2.fcs</span></span>
<span><span class="co">## b974e93be1c_4002_BDC-CR1.fcs b974e93be1c_4002_BDC-CR1.fcs</span></span>
<span><span class="co">## b976efe113c_4002_BDC-CR2.fcs b976efe113c_4002_BDC-CR2.fcs</span></span>
<span><span class="co">## b9752f2a967_4002_TNK-CR1.fcs b9752f2a967_4002_TNK-CR1.fcs</span></span>
<span><span class="co">## b973dcd50cc_4002_TNK-CR2.fcs b973dcd50cc_4002_TNK-CR2.fcs</span></span>
<span><span class="co">## b9724ab3921_4003_BDC-CR1.fcs b9724ab3921_4003_BDC-CR1.fcs</span></span>
<span><span class="co">## b9773f7bc42_4003_BDC-CR2.fcs b9773f7bc42_4003_BDC-CR2.fcs</span></span>
<span><span class="co">## b9720901b1c_4003_TNK-CR1.fcs b9720901b1c_4003_TNK-CR1.fcs</span></span>
<span><span class="co">## b974c518dbf_4003_TNK-CR2.fcs b974c518dbf_4003_TNK-CR2.fcs</span></span></code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add metadata </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">metadata</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                              Treatment         panel</span></span>
<span><span class="co">## b97615bf0a5_4000_BDC-CR1.fcs   Treated Myeloid Panel</span></span>
<span><span class="co">## b9711543845_4000_BDC-CR2.fcs   Treated Myeloid Panel</span></span>
<span><span class="co">## b977d45bce0_4000_TNK-CR1.fcs   Treated  T Cell Panel</span></span>
<span><span class="co">## b9748bb2acf_4000_TNK-CR2.fcs   Treated  T Cell Panel</span></span>
<span><span class="co">## b972c30fdef_4001_BDC-CR1.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## b973f63eb39_4001_BDC-CR2.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## b972b7e203_4001_TNK-CR1.fcs  Untreated  T Cell Panel</span></span>
<span><span class="co">## b9770c0c3ee_4001_TNK-CR2.fcs   Treated  T Cell Panel</span></span>
<span><span class="co">## b974e93be1c_4002_BDC-CR1.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## b976efe113c_4002_BDC-CR2.fcs   Treated Myeloid Panel</span></span>
<span><span class="co">## b9752f2a967_4002_TNK-CR1.fcs Untreated  T Cell Panel</span></span>
<span><span class="co">## b973dcd50cc_4002_TNK-CR2.fcs Untreated  T Cell Panel</span></span>
<span><span class="co">## b9724ab3921_4003_BDC-CR1.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## b9773f7bc42_4003_BDC-CR2.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## b9720901b1c_4003_TNK-CR1.fcs Untreated  T Cell Panel</span></span>
<span><span class="co">## b974c518dbf_4003_TNK-CR2.fcs   Treated  T Cell Panel</span></span>
<span><span class="co">##                                                      name</span></span>
<span><span class="co">## b97615bf0a5_4000_BDC-CR1.fcs b97615bf0a5_4000_BDC-CR1.fcs</span></span>
<span><span class="co">## b9711543845_4000_BDC-CR2.fcs b9711543845_4000_BDC-CR2.fcs</span></span>
<span><span class="co">## b977d45bce0_4000_TNK-CR1.fcs b977d45bce0_4000_TNK-CR1.fcs</span></span>
<span><span class="co">## b9748bb2acf_4000_TNK-CR2.fcs b9748bb2acf_4000_TNK-CR2.fcs</span></span>
<span><span class="co">## b972c30fdef_4001_BDC-CR1.fcs b972c30fdef_4001_BDC-CR1.fcs</span></span>
<span><span class="co">## b973f63eb39_4001_BDC-CR2.fcs b973f63eb39_4001_BDC-CR2.fcs</span></span>
<span><span class="co">## b972b7e203_4001_TNK-CR1.fcs   b972b7e203_4001_TNK-CR1.fcs</span></span>
<span><span class="co">## b9770c0c3ee_4001_TNK-CR2.fcs b9770c0c3ee_4001_TNK-CR2.fcs</span></span>
<span><span class="co">## b974e93be1c_4002_BDC-CR1.fcs b974e93be1c_4002_BDC-CR1.fcs</span></span>
<span><span class="co">## b976efe113c_4002_BDC-CR2.fcs b976efe113c_4002_BDC-CR2.fcs</span></span>
<span><span class="co">## b9752f2a967_4002_TNK-CR1.fcs b9752f2a967_4002_TNK-CR1.fcs</span></span>
<span><span class="co">## b973dcd50cc_4002_TNK-CR2.fcs b973dcd50cc_4002_TNK-CR2.fcs</span></span>
<span><span class="co">## b9724ab3921_4003_BDC-CR1.fcs b9724ab3921_4003_BDC-CR1.fcs</span></span>
<span><span class="co">## b9773f7bc42_4003_BDC-CR2.fcs b9773f7bc42_4003_BDC-CR2.fcs</span></span>
<span><span class="co">## b9720901b1c_4003_TNK-CR1.fcs b9720901b1c_4003_TNK-CR1.fcs</span></span>
<span><span class="co">## b974c518dbf_4003_TNK-CR2.fcs b974c518dbf_4003_TNK-CR2.fcs</span></span></code></pre>
<p>The benefit having metadata is that we can use many of the
sub-setting operations in a metadata specific manner. <em>Note: Many of
the sub-setting operation for <code>flowFrame</code> is also applicable
for <code>flowSet</code> and <code>cytoset</code>. Important
distinction, however, is that subset operation for <code>cytoset</code>
will not create a copy of the data and will point to the same set on
disk.</em></p>
<p>This is much more convenient than going back and forth between the
files.</p>
<p>Example:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset by files that have myeloid staining panel</span></span>
<span><span class="va">fs_myeloid</span> <span class="op">&lt;-</span> <span class="va">fs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span><span class="op">[[</span><span class="st">"panel"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Myeloid Panel"</span></span>
<span>                 ,<span class="op">]</span></span>
<span></span>
<span><span class="va">fs_myeloid</span></span></code></pre></div>
<pre><code><span><span class="co">## A flowSet with 8 experiments.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## column names(33): FSC-A FSC-H ... remove_from_FS_FM Time</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/phenoData.html" class="external-link">pData</a></span><span class="op">(</span><span class="va">fs_myeloid</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                              Treatment         panel</span></span>
<span><span class="co">## b97615bf0a5_4000_BDC-CR1.fcs   Treated Myeloid Panel</span></span>
<span><span class="co">## b9711543845_4000_BDC-CR2.fcs   Treated Myeloid Panel</span></span>
<span><span class="co">## b972c30fdef_4001_BDC-CR1.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## b973f63eb39_4001_BDC-CR2.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## b974e93be1c_4002_BDC-CR1.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## b976efe113c_4002_BDC-CR2.fcs   Treated Myeloid Panel</span></span>
<span><span class="co">## b9724ab3921_4003_BDC-CR1.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">## b9773f7bc42_4003_BDC-CR2.fcs Untreated Myeloid Panel</span></span>
<span><span class="co">##                                                      name</span></span>
<span><span class="co">## b97615bf0a5_4000_BDC-CR1.fcs b97615bf0a5_4000_BDC-CR1.fcs</span></span>
<span><span class="co">## b9711543845_4000_BDC-CR2.fcs b9711543845_4000_BDC-CR2.fcs</span></span>
<span><span class="co">## b972c30fdef_4001_BDC-CR1.fcs b972c30fdef_4001_BDC-CR1.fcs</span></span>
<span><span class="co">## b973f63eb39_4001_BDC-CR2.fcs b973f63eb39_4001_BDC-CR2.fcs</span></span>
<span><span class="co">## b974e93be1c_4002_BDC-CR1.fcs b974e93be1c_4002_BDC-CR1.fcs</span></span>
<span><span class="co">## b976efe113c_4002_BDC-CR2.fcs b976efe113c_4002_BDC-CR2.fcs</span></span>
<span><span class="co">## b9724ab3921_4003_BDC-CR1.fcs b9724ab3921_4003_BDC-CR1.fcs</span></span>
<span><span class="co">## b9773f7bc42_4003_BDC-CR2.fcs b9773f7bc42_4003_BDC-CR2.fcs</span></span></code></pre>
<p>Example of <code>cytoset</code> sub-setting</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># demonstrate how cs point to the same underlying data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="st">"B515-A"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  -110.3859 22591.7363</span></span></code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset and show prior to transformation</span></span>
<span><span class="va">cs_small</span> <span class="op">&lt;-</span> <span class="va">cs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cs_small</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="st">"B515-A"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  -110.3859 22591.7363</span></span></code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a transformList</span></span>
<span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transformList-class.html" class="external-link">transformList</a></span><span class="op">(</span><span class="st">"B515-A"</span>,<span class="va">asinh</span><span class="op">)</span></span>
<span><span class="co"># transform</span></span>
<span><span class="va">cs_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">cs_small</span>,<span class="va">trans</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># after transformation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cs_small</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="st">"B515-A"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -5.397151 10.718487</span></span></code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># whole cs </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="st">"B515-A"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -5.397151 10.718487</span></span></code></pre>
<p>As you see, the transformation was applied to a subset
<code>cs_small</code> however the original <code>cs</code> was also
altered highlighting that both objects were pointing to the same data.
To perform a deep copy we can use <code><a href="https://rdrr.io/pkg/flowWorkspace/man/cytoframe.html" class="external-link">realize_view()</a></code></p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># look at underlying expression</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="st">"B515-A"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]   -85.39705 14721.02832</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subset and show prior to transformation</span></span>
<span><span class="va">cs_small2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cytoframe.html" class="external-link">realize_view</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cs_small2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="st">"B515-A"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]   -85.39705 14721.02832</span></span></code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a transformList</span></span>
<span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/transformList-class.html" class="external-link">transformList</a></span><span class="op">(</span><span class="st">"B515-A"</span>,<span class="va">asinh</span><span class="op">)</span></span>
<span><span class="co"># transform</span></span>
<span><span class="va">cs_small2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">cs_small2</span>,<span class="va">trans</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># after transformation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cs_small2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="st">"B515-A"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -5.140493 10.290179</span></span></code></pre>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># whole cs </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="st">"B515-A"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]   -85.39705 14721.02832</span></span></code></pre>
<p>Notice that <code>cs</code> is left unchanged.</p>
</div>
<div class="section level2">
<h2 id="adding-additional-fcs-files-to-flowset-and-cytoset">Adding additional FCS files to <code>flowSet</code> and
<code>cytoset</code><a class="anchor" aria-label="anchor" href="#adding-additional-fcs-files-to-flowset-and-cytoset"></a>
</h2>
<p>Lastly, we can also add additional FCS files to a
<code>flowSet</code> or <code>cytoset</code> using
<code>rbind2(flowSet1,flowFrame)</code> or
<code>cs_add_cytoframe</code>.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add to flowSet</span></span>
<span><span class="va">fs_small</span> <span class="op">&lt;-</span> <span class="va">fs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">fs_small</span></span></code></pre></div>
<pre><code><span><span class="co">## A flowSet with 1 experiments.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## column names(33): FSC-A FSC-H ... remove_from_FS_FM Time</span></span></code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add a flowFrame</span></span>
<span><span class="va">fs_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/cbind2.html" class="external-link">rbind2</a></span><span class="op">(</span><span class="va">fs_small</span>, <span class="va">fs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># fs[[2]] results in a flowFrame</span></span>
<span><span class="va">fs_small</span></span></code></pre></div>
<pre><code><span><span class="co">## A flowSet with 2 experiments.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## column names(33): FSC-A FSC-H ... remove_from_FS_FM Time</span></span></code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add a flowSet</span></span>
<span><span class="va">fs_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/cbind2.html" class="external-link">rbind2</a></span><span class="op">(</span><span class="va">fs_small</span>, <span class="va">fs</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="co"># fs[3] results in a flowSet</span></span>
<span><span class="va">fs_small</span></span></code></pre></div>
<pre><code><span><span class="co">## A flowSet with 3 experiments.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## column names(33): FSC-A FSC-H ... remove_from_FS_FM Time</span></span></code></pre>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add to cytoset</span></span>
<span><span class="va">cs_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cytoframe.html" class="external-link">realize_view</a></span><span class="op">(</span><span class="va">cs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># deep copy</span></span>
<span><span class="va">cs_small</span></span></code></pre></div>
<pre><code><span><span class="co">## A cytoset with 1 samples.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   column names:</span></span>
<span><span class="co">##     FSC-A, FSC-H, SSC-A, B515-A, B610-A, B660-A, B710-A, B780-A, G575-A, G610-A, G660-A, G710-A, G780-A, R670-A, R730-A, R780-A, U390-A, U450-A, U500-A, U570-A, U660-A, U740-A, U785-A, V450-A, V510-A, V570-A, V605-A, V655-A, V710-A, V750-A, V785-A, remove_from_FS_FM, Time</span></span></code></pre>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># no need to point to cs_small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/cs_add_cytoframe.html" class="external-link">cs_add_cytoframe</a></span><span class="op">(</span>cs <span class="op">=</span> <span class="va">cs_small</span>, sn <span class="op">=</span> <span class="st">"Sample Name"</span>, cf <span class="op">=</span> <span class="va">cs</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># cs[[3]] results in a cytoframe</span></span>
<span><span class="va">cs_small</span></span></code></pre></div>
<pre><code><span><span class="co">## A cytoset with 2 samples.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   column names:</span></span>
<span><span class="co">##     FSC-A, FSC-H, SSC-A, B515-A, B610-A, B660-A, B710-A, B780-A, G575-A, G610-A, G660-A, G710-A, G780-A, R670-A, R730-A, R780-A, U390-A, U450-A, U500-A, U570-A, U660-A, U740-A, U785-A, V450-A, V510-A, V570-A, V605-A, V655-A, V710-A, V750-A, V785-A, remove_from_FS_FM, Time</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew McDavid, Arpan Neupan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
