<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gating Cells in cytoverse using gatingTemplates (optional) • CytoverseBioc2023</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Gating Cells in cytoverse using gatingTemplates (optional)">
<meta property="og:description" content="CytoverseBioc2023">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CytoverseBioc2023</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9007</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/1_Import_fcs.html">Importing and Basics of working with FCS files</a>
    </li>
    <li>
      <a href="../articles/2_Spillover_transformation.html">Spillover, Transformation, and Visualization</a>
    </li>
    <li>
      <a href="../articles/3_Gating_1.html">Gating Cells with scripts</a>
    </li>
    <li>
      <a href="../articles/4_Gating_gatingTemplate.html">Gating Cells with gatingTemplates</a>
    </li>
    <li>
      <a href="../articles/5_ggcyto.html">Visualizations using ggcyto</a>
    </li>
    <li>
      <a href="../articles/6_Reporting.html">Reporting: Counts, Frequency, etc.</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OzetteTech/cytoverse-bioc-2023" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Gating Cells in cytoverse using gatingTemplates
(optional)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OzetteTech/cytoverse-bioc-2023/blob/HEAD/vignettes/5_Gating_gatingTemplate.Rmd" class="external-link"><code>vignettes/5_Gating_gatingTemplate.Rmd</code></a></small>
      <div class="hidden name"><code>5_Gating_gatingTemplate.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="using-opencyto-gatingtemplate">Using openCyto gatingTemplate<a class="anchor" aria-label="anchor" href="#using-opencyto-gatingtemplate"></a>
</h2>
<p>In <a href="3_Gating_1.Rmd"><strong>Part 1</strong></a> we identified
various gates available in <code>cytoverse</code> and how to use them.
Here, we show how users can compose a similar gating scheme by using a
<code>gatingTemplate</code>.</p>
<p>A <code>gatingTemplate</code> is a csv file that describes the gating
sequence and the gating methods. In the <code>gatingTemplate</code> csv
file, we can leverage the various automated gating methods that we have
previously seen, without explicitly requiring to script it in
<strong>R</strong>.</p>
<p>Let’s take a look at an example <code>gatingTemplate</code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load gatingTemplate csv</span></span>
<span><span class="va">gt_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cache_workshop_data.html">get_workshop_data</a></span><span class="op">(</span><span class="st">"gating_template/"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">gt_file</span><span class="op">$</span><span class="va">rpath</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="2%">
<col width="8%">
<col width="9%">
<col width="8%">
<col width="22%">
<col width="12%">
<col width="4%">
<col width="12%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">alias</th>
<th align="left">pop</th>
<th align="left">parent</th>
<th align="left">dims</th>
<th align="left">gating_method</th>
<th align="left">gating_args</th>
<th align="left">collapseDataForGating</th>
<th align="left">groupBy</th>
<th align="left">preprocessing_method</th>
<th align="left">preprocessing_args</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">singlet</td>
<td align="left">+</td>
<td align="left">root</td>
<td align="left">FSC-A,FSC-H</td>
<td align="left">singletGate</td>
<td align="left">wider_gate=FALSE,prediction_level=0.95</td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">live</td>
<td align="left">-</td>
<td align="left">singlet</td>
<td align="left">Live</td>
<td align="left">gate_quantile</td>
<td align="left">probs = 0.95</td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">lymphocytes</td>
<td align="left">+</td>
<td align="left">live</td>
<td align="left">FSC-A,SSC-A</td>
<td align="left">flowClust.2d</td>
<td align="left">K = 1,target = c(1E5,0.5E3)</td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">CD3 + Cells</td>
<td align="left">+</td>
<td align="left">lymphocytes</td>
<td align="left">CD3</td>
<td align="left">mindensity</td>
<td align="left"></td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">non-NKT Cells</td>
<td align="left">-</td>
<td align="left">CD3 + Cells</td>
<td align="left">CD1d</td>
<td align="left">mindensity</td>
<td align="left"></td>
<td align="left">TRUE</td>
<td align="left">status</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NKT Cells</td>
<td align="left">+</td>
<td align="left">CD3 + Cells</td>
<td align="left">CD1d</td>
<td align="left">mindensity</td>
<td align="left">gate_range=c(130,200),min = 130</td>
<td align="left">TRUE</td>
<td align="left">status</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">True_NKT Cells</td>
<td align="left">+</td>
<td align="left">NKT Cells</td>
<td align="left">CD1d,CD3</td>
<td align="left">flowClust.2d</td>
<td align="left">K=2,target=c(150,175)</td>
<td align="left">TRUE</td>
<td align="left">status</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Conv T Cells</td>
<td align="left">–</td>
<td align="left">non-NKT Cells</td>
<td align="left">Vd1,Vg9</td>
<td align="left">mindensity</td>
<td align="left"></td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">MAIT Cells</td>
<td align="left">++</td>
<td align="left">Conv T Cells</td>
<td align="left">CD161,TCR Va7_2</td>
<td align="left">gate_quantile</td>
<td align="left">probs = 0.97</td>
<td align="left">TRUE</td>
<td align="left">status</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">not_MAIT Cells</td>
<td align="left">+</td>
<td align="left">Conv T Cells</td>
<td align="left"></td>
<td align="left">boolGate</td>
<td align="left">!MAIT Cells</td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">CD4_ref</td>
<td align="left">+</td>
<td align="left">not_MAIT Cells</td>
<td align="left">CD4</td>
<td align="left">mindensity</td>
<td align="left"></td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">CD8_ref</td>
<td align="left">+</td>
<td align="left">not_MAIT Cells</td>
<td align="left">CD8</td>
<td align="left">mindensity</td>
<td align="left"></td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">CD4+ T Cells</td>
<td align="left">+-</td>
<td align="left">not_MAIT Cells</td>
<td align="left">CD4,CD8</td>
<td align="left">refGate</td>
<td align="left">CD4_ref:CD8_ref</td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">CD8+ T Cells</td>
<td align="left">-+</td>
<td align="left">not_MAIT Cells</td>
<td align="left">CD4,CD8</td>
<td align="left">refGate</td>
<td align="left">CD4_ref:CD8_ref</td>
<td align="left">NA</td>
<td align="left"></td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="required-columns">Required columns<a class="anchor" aria-label="anchor" href="#required-columns"></a>
</h3>
<p>There are 10 columns that are required in a gatingTemplate csv
file:</p>
<ul>
<li>
<strong>alias#</strong> : name (alias) of the gate</li>
<li>
<strong>pop#</strong> : + or -; a combination such as: –, -+, ++,
+-; *.</li>
<li>
<strong>parent#</strong> : parent population</li>
<li>
<strong>dims#</strong> : channels or markernames</li>
<li>
<strong>gating_method#</strong> : gating method to be used. example:
<em>mindensity</em>
</li>
<li>
<strong>gating_args</strong>: additional arguments that can be
passed to <strong>gating_methods</strong>
</li>
<li>
<strong>collapseDataForGating</strong>: <strong>logical</strong>
indicating if the data is to be collapsed onto a single
<code>flowFrame</code> before estimation</li>
<li>
<strong>groupBy</strong>: string indicating the grouping variable
(within <code>pData</code> slot of the <code>GatingSet</code>)</li>
<li>
<strong>preprocessing_method</strong>: preprocessing method to be
used</li>
<li>
<strong>preprocessing_args</strong>: additional arguments that can
be passed to <strong>preprocessing_method</strong>
</li>
</ul>
<p><em>Note:</em> # indicates that these fields must be completed.
Others can be left blank.</p>
</div>
<div class="section level3">
<h3 id="understanding-the-structure-of-a-gatingtemplate-csv-file">Understanding the structure of a <code>gatingTemplate</code> csv
file<a class="anchor" aria-label="anchor" href="#understanding-the-structure-of-a-gatingtemplate-csv-file"></a>
</h3>
<p>Above, It should be apparent that the each row of the
<code>gatingTemplate</code> csv file is akin to the function call to a
specific type of gate.</p>
<p>Let’s take a look at a <em>simple</em> example of the node
<code>singlet</code>:</p>
<ul>
<li>
<code>alias</code>: singlet <em>name of the gate</em>
</li>
<li>
<code>pop</code>: + <em>indicating that we want events inside the
gate</em>
</li>
<li>
<code>parent</code>: root <em>indicating the parent
population</em>
</li>
<li>
<code>dims</code>: FSC-A,FSC-H <em>indicating the channels that the
function should use</em>
</li>
<li>
<code>gating_method</code>: singletGate <em>indicating the gating
method</em>
</li>
<li>
<code>gating_args</code>:wider_gate=FALSE,prediction_level=0.95
<em>indicating a tight gate</em>
</li>
<li>
<code>collapseDataForGating</code>: FALSE <em>indicating not to
collapse the entire <code>GatingSet</code> into 1 <code>flowFrame</code>
for estimation</em>
</li>
<li>
<code>groupBy</code>: NA <em>indicating that no grouping is to be
done</em>
</li>
<li>
<code>preprocessing_method</code>: NA <em>indicating that no
preprocessing is to be done</em>
</li>
<li>
<code>preprocessing_args</code>: NA <em>indicating that no
preprocessing argument is specified</em>
</li>
</ul>
<p>The row for the <code>CD4+ T Cells</code> we note:</p>
<ul>
<li><p><code>gating_method</code>: refGate</p></li>
<li><p><code>gating_args</code>: CD4_ref:CD8_ref</p></li>
</ul>
<p>A <code>refGate</code> (reference gate) allows us to build gates by
providing <em>references</em> to a previously constructed gates. In this
instance, we first constructed 1D gates <code>CD4_ref</code> and
<code>CD8_ref</code>, and leveraged them to generate our
<code>CD4+ T Cells</code> gate.</p>
<p>Also note:</p>
<ul>
<li><p><code>pop</code>:+-</p></li>
<li><p><code>dims</code>: CD4,CD8</p></li>
</ul>
<p>Here we indicated that <code>CD4+ T Cells</code> are
<strong>CD4+</strong> and <strong>CD8-</strong>.</p>
<p><em>A word of caution: We did not specify channels, rather we left
<code>openCyto</code> to match the <code>dims</code> argument with
markernames of the <code>GatingSet</code>. If there are similarly named
markers (<code>CD3</code> and <code>CD33</code>) and we provide
<code>dims: CD3</code>, the process will not complete
successfully!</em></p>
</div>
</div>
<div class="section level2">
<h2 id="visualizing-the-gatingtemplate-tree">Visualizing the <code>gatingTemplate</code> tree<a class="anchor" aria-label="anchor" href="#visualizing-the-gatingtemplate-tree"></a>
</h2>
<p>Let us now parse this csv file into a <code>gatingTemplate</code>
object</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">openCyto</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># directly read in a csv</span></span>
<span><span class="va">gt</span> <span class="op">&lt;-</span> <span class="fu">openCyto</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gatingTemplate-class.html" class="external-link">gatingTemplate</a></span><span class="op">(</span><span class="va">gt_file</span><span class="op">$</span><span class="va">rpath</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have <code>gt</code> we should first visualize the
hierarchy to <strong>confirm</strong> that it matches our expectations!
To achieve this we use <code>plot</code>. As well, we will compare it to
the <code>GatingSet</code> we created earlier.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># show gt</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gt</span><span class="op">)</span></span></code></pre></div>
<p><img src="5_Gating_gatingTemplate_files/figure-html/plot_gt-1.png" width="700"></p>
<p>The tree diagram summarizes the gating path as well as the gating
methods used. Also note that the <code>grey</code> colored arrows
identify <strong>helper gates</strong>. These are gates which
constructed in to <em>help</em> construct a final gate. Above, the gate
for <code>MAIT Cells</code> is to be created by first constructing 2, 1D
gates <code>TCR Va7_2+</code> and <code>CD161+</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># show gs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gs</span><span class="op">)</span></span></code></pre></div>
<p><img src="5_Gating_gatingTemplate_files/figure-html/plot_gs-1.png" width="700"></p>
<p>Beside the names, most nodes look the same!</p>
</div>
<div class="section level2">
<h2 id="adding-a-new-population">Adding a new population<a class="anchor" aria-label="anchor" href="#adding-a-new-population"></a>
</h2>
<p>Let’s append a 1 more population to this scheme: -
<code>Non Naive</code> defined as <code>CCR7+CD45RA-</code> or
<code>CCR7-CD45RA-</code> or <code>CCR7-CD45RA+</code></p>
<p>To do this, we first create a <code>Naive</code> node and then negate
it!</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Non Naive</span></span>
<span><span class="va">additional_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  alias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Naive"</span>, <span class="st">"Non Naive"</span><span class="op">)</span>,</span>
<span>  pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"++"</span>,<span class="st">"+"</span><span class="op">)</span>,</span>
<span>  parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4+ T Cells"</span>,<span class="st">"CD4+ T Cells"</span><span class="op">)</span>,</span>
<span>  dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CCR7,CD45RA"</span>,<span class="st">"CCR7,CD45RA"</span><span class="op">)</span>,</span>
<span>  gating_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mindensity"</span>, <span class="st">"boolGate"</span><span class="op">)</span>,</span>
<span>  gating_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">"!Naive"</span><span class="op">)</span>,</span>
<span>  collapseDataForGating <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">""</span><span class="op">)</span>,</span>
<span>  groupBy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">""</span><span class="op">)</span>,</span>
<span>  preprocessing_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">""</span><span class="op">)</span>,</span>
<span>  preprocessing_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">""</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">gt_file</span><span class="op">$</span><span class="va">rpath</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">additional_rows</span><span class="op">)</span><span class="op">|&gt;</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gatingTemplate-class.html" class="external-link">gatingTemplate</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># visualize</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gt</span><span class="op">)</span></span></code></pre></div>
<p><img src="5_Gating_gatingTemplate_files/figure-html/append_gt-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="running-and-attaching-the-nodes-to-the-gatingset">Running and attaching the nodes to the <code>GatingSet</code><a class="anchor" aria-label="anchor" href="#running-and-attaching-the-nodes-to-the-gatingset"></a>
</h2>
<p>Since we have saved our <code>GatingSet</code> let’s first remove all
the nodes including and downstream of <code>singlet</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># clean gs</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gs_pop_add.html" class="external-link">gs_pop_remove</a></span><span class="op">(</span><span class="va">gs</span>, <span class="st">"singlet"</span><span class="op">)</span> <span class="co"># removes singlet and all children nodes</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/recompute.html" class="external-link">recompute</a></span><span class="op">(</span><span class="va">gs</span><span class="op">)</span></span></code></pre></div>
<p>We now use <code>gt_gating(gt,gs)</code> to estimate and attach gates
to the <code>GatingSet</code> in a single call.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add gates defined in gatingTemplate</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gt_gating.html" class="external-link">gt_gating</a></span><span class="op">(</span><span class="va">gt</span>, <span class="va">gs</span><span class="op">)</span> <span class="co"># simply provide the parsed gatingTemplate and the GatingSet</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/recompute.html" class="external-link">recompute</a></span><span class="op">(</span><span class="va">gs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize Gating Hierarchy</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gs</span>, bool <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="5_Gating_gatingTemplate_files/figure-html/compute_with_gating_template-1.png" width="700"></p>
<p>We see that all the helper gates are also visualized. We can’t remove
them as it would affect downstream nodes! However we can hide them.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Too many nodes being shown, let's hide helper gates</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gt_toggle_helpergates.html" class="external-link">gt_toggle_helpergates</a></span><span class="op">(</span><span class="va">gt</span>,<span class="va">gs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># surface MAIT Cells</span></span>
<span><span class="co">## labelled as helper since not_MAIT_Cells was created using reference for MAIT Cells</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/flowWorkspace/man/gs_pop_set_visibility.html" class="external-link">gs_pop_set_visibility</a></span><span class="op">(</span><span class="va">gs</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAIT Cells"</span><span class="op">)</span>,</span>
<span>                      <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $`4000_TNK-CR1`</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`4001_TNK-CR1`</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`4002_TNK-CR1`</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`4003_TNK-CR1`</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualize the full gated data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">gs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, bool <span class="op">=</span> <span class="cn">TRUE</span>, bins <span class="op">=</span> <span class="fl">128</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/ggcyto_par_set.html" class="external-link">ggcyto_par_set</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="5_Gating_gatingTemplate_files/figure-html/hide_nodes_gt-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this section we took a brief look at how to use a
<code>gatingTemplate</code> csv file to compose and rapidly gate cells
within a <code>GatingSet</code>. The portability of the
<code>gatingTemplate</code> csv ensures that all users utilizing this
template file will result in the exact same <code>GatingHierarchy</code>
and gates.</p>
<p>There are additional functionalities in the <code>openCyto</code>
library, which we did not go over due to time constraints. We encourage
participants to explore the examples outlined <a href="https://cytoverse.org/examples/index.html" class="external-link">here</a> as well as
read through the <a href="http://www.bioconductor.org/packages/devel/bioc/vignettes/openCyto/inst/doc/openCytoVignette.html" class="external-link">vignette</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew McDavid, Arpan Neupane.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
